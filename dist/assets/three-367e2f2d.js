var Di=Object.defineProperty;var ki=(i,e,t)=>e in i?Di(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var I=(i,e,t)=>(ki(i,typeof e!="symbol"?e+"":e,t),t);import{L as Bi,s as Ee,V as P,t as H,u as Gt,v as re,w as dt,x as qs,M as G,y as Q,z as Fi,D as kn,A as bn,e as qe,C as Ui,E as mt,H as Ze,P as Bn,I as le,J as Hi,N as zi,O as ji,U as Ki,Q as $s,R as is,X as Oe,Y as Qt,Z as Fn,_ as Ft,$ as os,a0 as zt,a1 as rs,a2 as Vi,a3 as Zs,a4 as Ie,a5 as Un,a6 as yt,S as Qs,a7 as Hn,a8 as Gi,a9 as Js,aa as _n,ab as jt,ac as Xi,ad as Wi,ae as Yi,af as as,ag as ei,ah as ti,ai as ni,aj as si,ak as qi,al as wn,am as ii,an as $i,ao as Tn,ap as oi,aq as Zi,ar as Qi,as as Ji,at as Me,au as eo,T as ri,av as to,aw as no,ax as ai,ay as ci,az as vn,f as so,aA as io,aB as oo,aC as ro,aD as ao,g as co,aE as Jt,aF as lo,aG as uo,aH as fo,aI as ho,aJ as li,aK as po,aL as mo,aM as yo,aN as go,aO as xo,aP as Ao,aQ as bo,aR as _o,aS as cs,aT as ls,aU as us,aV as fs,aW as wo,aX as To,aY as vo,aZ as Eo,a_ as So,a$ as Mo,b0 as De,b1 as ke,b2 as ds,W as Po,b3 as Ro,b4 as Lo}from"./three.module-5ba9cbb1.js";function Co(i){return typeof i=="object"&&i!==null&&"isMesh"in i}function Io(i){return i instanceof Bi}const ui=0,Oo=1,No=2,hs=2,en=1.25,ps=1,Ut=6*4+4+4,Xt=65535,Do=Math.pow(2,-24),tn=Symbol("SKIP_GENERATION");function ko(i){return i.index?i.index.count:i.attributes.position.count}function Qe(i){return ko(i)/3}function Bo(i,e=ArrayBuffer){return i>65535?new Uint32Array(new e(4*i)):new Uint16Array(new e(2*i))}function Fo(i,e){if(!i.index){const t=i.attributes.position.count,n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=Bo(t,n);i.setIndex(new Ee(s,1));for(let o=0;o<t;o++)s[o]=o}}function fi(i){const e=Qe(i),t=i.drawRange,n=t.start/3,s=(t.start+t.count)/3,o=Math.max(0,n),r=Math.min(e,s)-o;return[{offset:Math.floor(o),count:Math.floor(r)}]}function di(i){if(!i.groups||!i.groups.length)return fi(i);const e=[],t=new Set,n=i.drawRange,s=n.start/3,o=(n.start+n.count)/3;for(const c of i.groups){const a=c.start/3,l=(c.start+c.count)/3;t.add(Math.max(s,a)),t.add(Math.min(o,l))}const r=Array.from(t.values()).sort((c,a)=>c-a);for(let c=0;c<r.length-1;c++){const a=r[c],l=r[c+1];e.push({offset:Math.floor(a),count:Math.floor(l-a)})}return e}function Uo(i){if(i.groups.length===0)return!1;const e=Qe(i),t=di(i).sort((o,r)=>o.offset-r.offset),n=t[t.length-1];n.count=Math.min(e-n.offset,n.count);let s=0;return t.forEach(({count:o})=>s+=o),e!==s}function U(i,e,t){return t.min.x=e[i],t.min.y=e[i+1],t.min.z=e[i+2],t.max.x=e[i+3],t.max.y=e[i+4],t.max.z=e[i+5],t}function Ho(i){i[0]=i[1]=i[2]=1/0,i[3]=i[4]=i[5]=-1/0}function ms(i){let e=-1,t=-1/0;for(let n=0;n<3;n++){const s=i[n+3]-i[n];s>t&&(t=s,e=n)}return e}function ys(i,e){e.set(i)}function gs(i,e,t){let n,s;for(let o=0;o<3;o++){const r=o+3;n=i[o],s=e[o],t[o]=n<s?n:s,n=i[r],s=e[r],t[r]=n>s?n:s}}function bt(i,e,t){for(let n=0;n<3;n++){const s=e[i+2*n],o=e[i+2*n+1],r=s-o,c=s+o;r<t[n]&&(t[n]=r),c>t[n+3]&&(t[n+3]=c)}}function nt(i){const e=i[3]-i[0],t=i[4]-i[1],n=i[5]-i[2];return 2*(e*t+t*n+n*e)}function nn(i,e,t,n,s=null){let o=1/0,r=1/0,c=1/0,a=-1/0,l=-1/0,f=-1/0,u=1/0,d=1/0,h=1/0,m=-1/0,x=-1/0,p=-1/0;const y=s!==null;for(let g=e*6,b=(e+t)*6;g<b;g+=6){const A=i[g+0],_=i[g+1],v=A-_,T=A+_;v<o&&(o=v),T>a&&(a=T),y&&A<u&&(u=A),y&&A>m&&(m=A);const E=i[g+2],M=i[g+3],R=E-M,L=E+M;R<r&&(r=R),L>l&&(l=L),y&&E<d&&(d=E),y&&E>x&&(x=E);const S=i[g+4],C=i[g+5],O=S-C,D=S+C;O<c&&(c=O),D>f&&(f=D),y&&S<h&&(h=S),y&&S>p&&(p=S)}n[0]=o,n[1]=r,n[2]=c,n[3]=a,n[4]=l,n[5]=f,y&&(s[0]=u,s[1]=d,s[2]=h,s[3]=m,s[4]=x,s[5]=p)}function zo(i,e,t,n){let s=1/0,o=1/0,r=1/0,c=-1/0,a=-1/0,l=-1/0;for(let f=e*6,u=(e+t)*6;f<u;f+=6){const d=i[f+0];d<s&&(s=d),d>c&&(c=d);const h=i[f+2];h<o&&(o=h),h>a&&(a=h);const m=i[f+4];m<r&&(r=m),m>l&&(l=m)}n[0]=s,n[1]=o,n[2]=r,n[3]=c,n[4]=a,n[5]=l}function jo(i,e){Ho(e);const t=i.attributes.position,n=i.index?i.index.array:null,s=Qe(i),o=new Float32Array(s*6),r=t.normalized,c=t.array,a=t.offset||0;let l=3;t.isInterleavedBufferAttribute&&(l=t.data.stride);const f=["getX","getY","getZ"];for(let u=0;u<s;u++){const d=u*3,h=u*6;let m=d+0,x=d+1,p=d+2;n&&(m=n[m],x=n[x],p=n[p]),r||(m=m*l+a,x=x*l+a,p=p*l+a);for(let y=0;y<3;y++){let g,b,A;r?(g=t[f[y]](m),b=t[f[y]](x),A=t[f[y]](p)):(g=c[m+y],b=c[x+y],A=c[p+y]);let _=g;b<_&&(_=b),A<_&&(_=A);let v=g;b>v&&(v=b),A>v&&(v=A);const T=(v-_)/2,E=y*2;o[h+E+0]=_+T,o[h+E+1]=T+(Math.abs(_)+T)*Do,_<e[y]&&(e[y]=_),v>e[y+3]&&(e[y+3]=v)}}return o}const pe=32,Ko=(i,e)=>i.candidate-e.candidate,be=new Array(pe).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),_t=new Float32Array(6);function Vo(i,e,t,n,s,o){let r=-1,c=0;if(o===ui)r=ms(e),r!==-1&&(c=(e[r]+e[r+3])/2);else if(o===Oo)r=ms(i),r!==-1&&(c=Go(t,n,s,r));else if(o===No){const a=nt(i);let l=en*s;const f=n*6,u=(n+s)*6;for(let d=0;d<3;d++){const h=e[d],p=(e[d+3]-h)/pe;if(s<pe/4){const y=[...be];y.length=s;let g=0;for(let A=f;A<u;A+=6,g++){const _=y[g];_.candidate=t[A+2*d],_.count=0;const{bounds:v,leftCacheBounds:T,rightCacheBounds:E}=_;for(let M=0;M<3;M++)E[M]=1/0,E[M+3]=-1/0,T[M]=1/0,T[M+3]=-1/0,v[M]=1/0,v[M+3]=-1/0;bt(A,t,v)}y.sort(Ko);let b=s;for(let A=0;A<b;A++){const _=y[A];for(;A+1<b&&y[A+1].candidate===_.candidate;)y.splice(A+1,1),b--}for(let A=f;A<u;A+=6){const _=t[A+2*d];for(let v=0;v<b;v++){const T=y[v];_>=T.candidate?bt(A,t,T.rightCacheBounds):(bt(A,t,T.leftCacheBounds),T.count++)}}for(let A=0;A<b;A++){const _=y[A],v=_.count,T=s-_.count,E=_.leftCacheBounds,M=_.rightCacheBounds;let R=0;v!==0&&(R=nt(E)/a);let L=0;T!==0&&(L=nt(M)/a);const S=ps+en*(R*v+L*T);S<l&&(r=d,l=S,c=_.candidate)}}else{for(let b=0;b<pe;b++){const A=be[b];A.count=0,A.candidate=h+p+b*p;const _=A.bounds;for(let v=0;v<3;v++)_[v]=1/0,_[v+3]=-1/0}for(let b=f;b<u;b+=6){let v=~~((t[b+2*d]-h)/p);v>=pe&&(v=pe-1);const T=be[v];T.count++,bt(b,t,T.bounds)}const y=be[pe-1];ys(y.bounds,y.rightCacheBounds);for(let b=pe-2;b>=0;b--){const A=be[b],_=be[b+1];gs(A.bounds,_.rightCacheBounds,A.rightCacheBounds)}let g=0;for(let b=0;b<pe-1;b++){const A=be[b],_=A.count,v=A.bounds,E=be[b+1].rightCacheBounds;_!==0&&(g===0?ys(v,_t):gs(v,_t,_t)),g+=_;let M=0,R=0;g!==0&&(M=nt(_t)/a);const L=s-g;L!==0&&(R=nt(E)/a);const S=ps+en*(M*g+R*L);S<l&&(r=d,l=S,c=A.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:r,pos:c}}function Go(i,e,t,n){let s=0;for(let o=e,r=e+t;o<r;o++)s+=i[o*6+n*2];return s/t}class wt{constructor(){}}function Xo(i,e,t,n,s,o){let r=n,c=n+s-1;const a=o.pos,l=o.axis*2;for(;;){for(;r<=c&&t[r*6+l]<a;)r++;for(;r<=c&&t[c*6+l]>=a;)c--;if(r<c){for(let f=0;f<3;f++){let u=e[r*3+f];e[r*3+f]=e[c*3+f],e[c*3+f]=u}for(let f=0;f<6;f++){let u=t[r*6+f];t[r*6+f]=t[c*6+f],t[c*6+f]=u}r++,c--}else return r}}function Wo(i,e,t,n,s,o){let r=n,c=n+s-1;const a=o.pos,l=o.axis*2;for(;;){for(;r<=c&&t[r*6+l]<a;)r++;for(;r<=c&&t[c*6+l]>=a;)c--;if(r<c){let f=i[r];i[r]=i[c],i[c]=f;for(let u=0;u<6;u++){let d=t[r*6+u];t[r*6+u]=t[c*6+u],t[c*6+u]=d}r++,c--}else return r}}function Yo(i,e){const t=(i.index?i.index.count:i.attributes.position.count)/3,n=t>2**16,s=n?4:2,o=e?new SharedArrayBuffer(t*s):new ArrayBuffer(t*s),r=n?new Uint32Array(o):new Uint16Array(o);for(let c=0,a=r.length;c<a;c++)r[c]=c;return r}function qo(i,e){const t=i.geometry,n=t.index?t.index.array:null,s=e.maxDepth,o=e.verbose,r=e.maxLeafTris,c=e.strategy,a=e.onProgress,l=Qe(t),f=i._indirectBuffer;let u=!1;const d=new Float32Array(6),h=new Float32Array(6),m=jo(t,d),x=e.indirect?Wo:Xo,p=[],y=e.indirect?fi(t):di(t);if(y.length===1){const A=y[0],_=new wt;_.boundingData=d,zo(m,A.offset,A.count,h),b(_,A.offset,A.count,h),p.push(_)}else for(let A of y){const _=new wt;_.boundingData=new Float32Array(6),nn(m,A.offset,A.count,_.boundingData,h),b(_,A.offset,A.count,h),p.push(_)}return p;function g(A){a&&a(A/l)}function b(A,_,v,T=null,E=0){if(!u&&E>=s&&(u=!0,o&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),v<=r||E>=s)return g(_+v),A.offset=_,A.count=v,A;const M=Vo(A.boundingData,T,m,_,v,c);if(M.axis===-1)return g(_+v),A.offset=_,A.count=v,A;const R=x(f,n,m,_,v,M);if(R===_||R===_+v)g(_+v),A.offset=_,A.count=v;else{A.splitAxis=M.axis;const L=new wt,S=_,C=R-_;A.left=L,L.boundingData=new Float32Array(6),nn(m,S,C,L.boundingData,h),b(L,S,C,h,E+1);const O=new wt,D=R,B=v-C;A.right=O,O.boundingData=new Float32Array(6),nn(m,D,B,O.boundingData,h),b(O,D,B,h,E+1)}return A}}function $o(i,e){const t=i.geometry;e.indirect&&(i._indirectBuffer=Yo(t,e.useSharedArrayBuffer),Uo(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),i._indirectBuffer||Fo(t,e);const n=qo(i,e);let s,o,r;const c=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<n.length;u++){const d=n[u];let h=l(d);const m=new a(Ut*h);s=new Float32Array(m),o=new Uint32Array(m),r=new Uint16Array(m),f(0,d),c.push(m)}i._roots=c;return;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function f(u,d){const h=u/4,m=u/2,x=!!d.count,p=d.boundingData;for(let y=0;y<6;y++)s[h+y]=p[y];if(x){const y=d.offset,g=d.count;return o[h+6]=y,r[m+14]=g,r[m+15]=Xt,u+Ut}else{const y=d.left,g=d.right,b=d.splitAxis;let A;if(A=f(u+Ut,y),A/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return o[h+6]=A/4,A=f(A,g),o[h+7]=b,A}}}class me{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,s=-1/0;for(let o=0,r=e.length;o<r;o++){const a=e[o][t];n=a<n?a:n,s=a>s?a:s}this.min=n,this.max=s}setFromPoints(e,t){let n=1/0,s=-1/0;for(let o=0,r=t.length;o<r;o++){const c=t[o],a=e.dot(c);n=a<n?a:n,s=a>s?a:s}this.min=n,this.max=s}isSeparated(e){return this.min>e.max||e.min>this.max}}me.prototype.setFromBox=function(){const i=new P;return function(t,n){const s=n.min,o=n.max;let r=1/0,c=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let f=0;f<=1;f++){i.x=s.x*a+o.x*(1-a),i.y=s.y*l+o.y*(1-l),i.z=s.z*f+o.z*(1-f);const u=t.dot(i);r=Math.min(u,r),c=Math.max(u,c)}this.min=r,this.max=c}}();const Zo=function(){const i=new P,e=new P,t=new P;return function(s,o,r){const c=s.start,a=i,l=o.start,f=e;t.subVectors(c,l),i.subVectors(s.end,s.start),e.subVectors(o.end,o.start);const u=t.dot(f),d=f.dot(a),h=f.dot(f),m=t.dot(a),p=a.dot(a)*h-d*d;let y,g;p!==0?y=(u*d-m*h)/p:y=0,g=(u+y*d)/h,r.x=y,r.y=g}}(),zn=function(){const i=new H,e=new P,t=new P;return function(s,o,r,c){Zo(s,o,i);let a=i.x,l=i.y;if(a>=0&&a<=1&&l>=0&&l<=1){s.at(a,r),o.at(l,c);return}else if(a>=0&&a<=1){l<0?o.at(0,c):o.at(1,c),s.closestPointToPoint(c,!0,r);return}else if(l>=0&&l<=1){a<0?s.at(0,r):s.at(1,r),o.closestPointToPoint(r,!0,c);return}else{let f;a<0?f=s.start:f=s.end;let u;l<0?u=o.start:u=o.end;const d=e,h=t;if(s.closestPointToPoint(u,!0,e),o.closestPointToPoint(f,!0,t),d.distanceToSquared(u)<=h.distanceToSquared(f)){r.copy(d),c.copy(u);return}else{r.copy(f),c.copy(h);return}}}}(),Qo=function(){const i=new P,e=new P,t=new Gt,n=new re;return function(o,r){const{radius:c,center:a}=o,{a:l,b:f,c:u}=r;if(n.start=l,n.end=f,n.closestPointToPoint(a,!0,i).distanceTo(a)<=c||(n.start=l,n.end=u,n.closestPointToPoint(a,!0,i).distanceTo(a)<=c)||(n.start=f,n.end=u,n.closestPointToPoint(a,!0,i).distanceTo(a)<=c))return!0;const x=r.getPlane(t);if(Math.abs(x.distanceToPoint(a))<=c){const y=x.projectPoint(a,e);if(r.containsPoint(y))return!0}return!1}}(),Jo=1e-15;function sn(i){return Math.abs(i)<Jo}class ae extends dt{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new P),this.satBounds=new Array(4).fill().map(()=>new me),this.points=[this.a,this.b,this.c],this.sphere=new qs,this.plane=new Gt,this.needsUpdate=!0}intersectsSphere(e){return Qo(e,this)}update(){const e=this.a,t=this.b,n=this.c,s=this.points,o=this.satAxes,r=this.satBounds,c=o[0],a=r[0];this.getNormal(c),a.setFromPoints(c,s);const l=o[1],f=r[1];l.subVectors(e,t),f.setFromPoints(l,s);const u=o[2],d=r[2];u.subVectors(t,n),d.setFromPoints(u,s);const h=o[3],m=r[3];h.subVectors(n,e),m.setFromPoints(h,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(c,e),this.needsUpdate=!1}}ae.prototype.closestPointToSegment=function(){const i=new P,e=new P,t=new re;return function(s,o=null,r=null){const{start:c,end:a}=s,l=this.points;let f,u=1/0;for(let d=0;d<3;d++){const h=(d+1)%3;t.start.copy(l[d]),t.end.copy(l[h]),zn(t,s,i,e),f=i.distanceToSquared(e),f<u&&(u=f,o&&o.copy(i),r&&r.copy(e))}return this.closestPointToPoint(c,i),f=c.distanceToSquared(i),f<u&&(u=f,o&&o.copy(i),r&&r.copy(c)),this.closestPointToPoint(a,i),f=a.distanceToSquared(i),f<u&&(u=f,o&&o.copy(i),r&&r.copy(a)),Math.sqrt(u)}}();ae.prototype.intersectsTriangle=function(){const i=new ae,e=new Array(3),t=new Array(3),n=new me,s=new me,o=new P,r=new P,c=new P,a=new P,l=new P,f=new re,u=new re,d=new re,h=new P;function m(x,p,y){const g=x.points;let b=0,A=-1;for(let _=0;_<3;_++){const{start:v,end:T}=f;v.copy(g[_]),T.copy(g[(_+1)%3]),f.delta(r);const E=sn(p.distanceToPoint(v));if(sn(p.normal.dot(r))&&E){y.copy(f),b=2;break}const M=p.intersectLine(f,h);if(!M&&E&&h.copy(v),(M||E)&&!sn(h.distanceTo(T))){if(b<=1)(b===1?y.start:y.end).copy(h),E&&(A=b);else if(b>=2){(A===1?y.start:y.end).copy(h),b=2;break}if(b++,b===2&&A===-1)break}}return b}return function(p,y=null,g=!1){this.needsUpdate&&this.update(),p.isExtendedTriangle?p.needsUpdate&&p.update():(i.copy(p),i.update(),p=i);const b=this.plane,A=p.plane;if(Math.abs(b.normal.dot(A.normal))>1-1e-10){const _=this.satBounds,v=this.satAxes;t[0]=p.a,t[1]=p.b,t[2]=p.c;for(let M=0;M<4;M++){const R=_[M],L=v[M];if(n.setFromPoints(L,t),R.isSeparated(n))return!1}const T=p.satBounds,E=p.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let M=0;M<4;M++){const R=T[M],L=E[M];if(n.setFromPoints(L,e),R.isSeparated(n))return!1}for(let M=0;M<4;M++){const R=v[M];for(let L=0;L<4;L++){const S=E[L];if(o.crossVectors(R,S),n.setFromPoints(o,e),s.setFromPoints(o,t),n.isSeparated(s))return!1}}return y&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const _=m(this,A,u);if(_===1&&p.containsPoint(u.end))return y&&(y.start.copy(u.end),y.end.copy(u.end)),!0;if(_!==2)return!1;const v=m(p,b,d);if(v===1&&this.containsPoint(d.end))return y&&(y.start.copy(d.end),y.end.copy(d.end)),!0;if(v!==2)return!1;if(u.delta(c),d.delta(a),c.dot(a)<0){let C=d.start;d.start=d.end,d.end=C}const T=u.start.dot(c),E=u.end.dot(c),M=d.start.dot(c),R=d.end.dot(c),L=E<M,S=T<R;return T!==R&&M!==E&&L===S?!1:(y&&(l.subVectors(u.start,d.start),l.dot(c)>0?y.start.copy(u.start):y.start.copy(d.start),l.subVectors(u.end,d.end),l.dot(c)<0?y.end.copy(u.end):y.end.copy(d.end)),!0)}}}();ae.prototype.distanceToPoint=function(){const i=new P;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}}();ae.prototype.distanceToTriangle=function(){const i=new P,e=new P,t=["a","b","c"],n=new re,s=new re;return function(r,c=null,a=null){const l=c||a?n:null;if(this.intersectsTriangle(r,l))return(c||a)&&(c&&l.getCenter(c),a&&l.getCenter(a)),0;let f=1/0;for(let u=0;u<3;u++){let d;const h=t[u],m=r[h];this.closestPointToPoint(m,i),d=m.distanceToSquared(i),d<f&&(f=d,c&&c.copy(i),a&&a.copy(m));const x=this[h];r.closestPointToPoint(x,i),d=x.distanceToSquared(i),d<f&&(f=d,c&&c.copy(x),a&&a.copy(i))}for(let u=0;u<3;u++){const d=t[u],h=t[(u+1)%3];n.set(this[d],this[h]);for(let m=0;m<3;m++){const x=t[m],p=t[(m+1)%3];s.set(r[x],r[p]),zn(n,s,i,e);const y=i.distanceToSquared(e);y<f&&(f=y,c&&c.copy(i),a&&a.copy(e))}}return Math.sqrt(f)}}();class Y{constructor(e,t,n){this.isOrientedBox=!0,this.min=new P,this.max=new P,this.matrix=new G,this.invMatrix=new G,this.points=new Array(8).fill().map(()=>new P),this.satAxes=new Array(3).fill().map(()=>new P),this.satBounds=new Array(3).fill().map(()=>new me),this.alignedSatBounds=new Array(3).fill().map(()=>new me),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Y.prototype.update=function(){return function(){const e=this.matrix,t=this.min,n=this.max,s=this.points;for(let l=0;l<=1;l++)for(let f=0;f<=1;f++)for(let u=0;u<=1;u++){const d=1*l|2*f|4*u,h=s[d];h.x=l?n.x:t.x,h.y=f?n.y:t.y,h.z=u?n.z:t.z,h.applyMatrix4(e)}const o=this.satBounds,r=this.satAxes,c=s[0];for(let l=0;l<3;l++){const f=r[l],u=o[l],d=1<<l,h=s[d];f.subVectors(c,h),u.setFromPoints(f,s)}const a=this.alignedSatBounds;a[0].setFromPointsField(s,"x"),a[1].setFromPointsField(s,"y"),a[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Y.prototype.intersectsBox=function(){const i=new me;return function(t){this.needsUpdate&&this.update();const n=t.min,s=t.max,o=this.satBounds,r=this.satAxes,c=this.alignedSatBounds;if(i.min=n.x,i.max=s.x,c[0].isSeparated(i)||(i.min=n.y,i.max=s.y,c[1].isSeparated(i))||(i.min=n.z,i.max=s.z,c[2].isSeparated(i)))return!1;for(let a=0;a<3;a++){const l=r[a],f=o[a];if(i.setFromBox(l,t),f.isSeparated(i))return!1}return!0}}();Y.prototype.intersectsTriangle=function(){const i=new ae,e=new Array(3),t=new me,n=new me,s=new P;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(i.copy(r),i.update(),r=i);const c=this.satBounds,a=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let d=0;d<3;d++){const h=c[d],m=a[d];if(t.setFromPoints(m,e),h.isSeparated(t))return!1}const l=r.satBounds,f=r.satAxes,u=this.points;for(let d=0;d<3;d++){const h=l[d],m=f[d];if(t.setFromPoints(m,u),h.isSeparated(t))return!1}for(let d=0;d<3;d++){const h=a[d];for(let m=0;m<4;m++){const x=f[m];if(s.crossVectors(h,x),t.setFromPoints(s,e),n.setFromPoints(s,u),t.isSeparated(n))return!1}}return!0}}();Y.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Y.prototype.distanceToPoint=function(){const i=new P;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}}();Y.prototype.distanceToBox=function(){const i=["x","y","z"],e=new Array(12).fill().map(()=>new re),t=new Array(12).fill().map(()=>new re),n=new P,s=new P;return function(r,c=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(s),this.closestPointToPoint(s,n),r.closestPointToPoint(n,s),a&&a.copy(n),l&&l.copy(s)),0;const f=c*c,u=r.min,d=r.max,h=this.points;let m=1/0;for(let p=0;p<8;p++){const y=h[p];s.copy(y).clamp(u,d);const g=y.distanceToSquared(s);if(g<m&&(m=g,a&&a.copy(y),l&&l.copy(s),g<f))return Math.sqrt(g)}let x=0;for(let p=0;p<3;p++)for(let y=0;y<=1;y++)for(let g=0;g<=1;g++){const b=(p+1)%3,A=(p+2)%3,_=y<<b|g<<A,v=1<<p|y<<b|g<<A,T=h[_],E=h[v];e[x].set(T,E);const R=i[p],L=i[b],S=i[A],C=t[x],O=C.start,D=C.end;O[R]=u[R],O[L]=y?u[L]:d[L],O[S]=g?u[S]:d[L],D[R]=d[R],D[L]=y?u[L]:d[L],D[S]=g?u[S]:d[L],x++}for(let p=0;p<=1;p++)for(let y=0;y<=1;y++)for(let g=0;g<=1;g++){s.x=p?d.x:u.x,s.y=y?d.y:u.y,s.z=g?d.z:u.z,this.closestPointToPoint(s,n);const b=s.distanceToSquared(n);if(b<m&&(m=b,a&&a.copy(n),l&&l.copy(s),b<f))return Math.sqrt(b)}for(let p=0;p<12;p++){const y=e[p];for(let g=0;g<12;g++){const b=t[g];zn(y,b,n,s);const A=n.distanceToSquared(s);if(A<m&&(m=A,a&&a.copy(n),l&&l.copy(s),A<f))return Math.sqrt(A)}}return Math.sqrt(m)}}();class jn{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class er extends jn{constructor(){super(()=>new ae)}}const te=new er;function $(i,e){return e[i+15]===65535}function Z(i,e){return e[i+6]}function ne(i,e){return e[i+14]}function se(i){return i+8}function ie(i,e){return e[i+6]}function hi(i,e){return e[i+7]}class tr{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const F=new tr;let ve,We;const Be=[],Tt=new jn(()=>new Q);function nr(i,e,t,n,s,o){ve=Tt.getPrimitive(),We=Tt.getPrimitive(),Be.push(ve,We),F.setBuffer(i._roots[e]);const r=En(0,i.geometry,t,n,s,o);F.clearBuffer(),Tt.releasePrimitive(ve),Tt.releasePrimitive(We),Be.pop(),Be.pop();const c=Be.length;return c>0&&(We=Be[c-1],ve=Be[c-2]),r}function En(i,e,t,n,s=null,o=0,r=0){const{float32Array:c,uint16Array:a,uint32Array:l}=F;let f=i*2;if($(f,a)){const d=Z(i,l),h=ne(f,a);return U(i,c,ve),n(d,h,!1,r,o+i,ve)}else{let R=function(S){const{uint16Array:C,uint32Array:O}=F;let D=S*2;for(;!$(D,C);)S=se(S),D=S*2;return Z(S,O)},L=function(S){const{uint16Array:C,uint32Array:O}=F;let D=S*2;for(;!$(D,C);)S=ie(S,O),D=S*2;return Z(S,O)+ne(D,C)};const d=se(i),h=ie(i,l);let m=d,x=h,p,y,g,b;if(s&&(g=ve,b=We,U(m,c,g),U(x,c,b),p=s(g),y=s(b),y<p)){m=h,x=d;const S=p;p=y,y=S,g=b}g||(g=ve,U(m,c,g));const A=$(m*2,a),_=t(g,A,p,r+1,o+m);let v;if(_===hs){const S=R(m),O=L(m)-S;v=n(S,O,!0,r+1,o+m,g)}else v=_&&En(m,e,t,n,s,o,r+1);if(v)return!0;b=We,U(x,c,b);const T=$(x*2,a),E=t(b,T,y,r+1,o+x);let M;if(E===hs){const S=R(x),O=L(x)-S;M=n(S,O,!0,r+1,o+x,b)}else M=E&&En(x,e,t,n,s,o,r+1);return!!M}}const st=new P,on=new P;function sr(i,e,t={},n=0,s=1/0){const o=n*n,r=s*s;let c=1/0,a=null;if(i.shapecast({boundsTraverseOrder:f=>(st.copy(e).clamp(f.min,f.max),st.distanceToSquared(e)),intersectsBounds:(f,u,d)=>d<c&&d<r,intersectsTriangle:(f,u)=>{f.closestPointToPoint(e,st);const d=e.distanceToSquared(st);return d<c&&(on.copy(st),c=d,a=u),d<o}}),c===1/0)return null;const l=Math.sqrt(c);return t.point?t.point.copy(on):t.point=on.clone(),t.distance=l,t.faceIndex=a,t}const Fe=new P,Ue=new P,He=new P,vt=new H,Et=new H,St=new H,xs=new P,As=new P,bs=new P,Mt=new P;function ir(i,e,t,n,s,o){let r;return o===Fi?r=i.intersectTriangle(n,t,e,!0,s):r=i.intersectTriangle(e,t,n,o!==kn,s),r===null?null:{distance:i.origin.distanceTo(s),point:s.clone()}}function or(i,e,t,n,s,o,r,c,a){Fe.fromBufferAttribute(e,o),Ue.fromBufferAttribute(e,r),He.fromBufferAttribute(e,c);const l=ir(i,Fe,Ue,He,Mt,a);if(l){n&&(vt.fromBufferAttribute(n,o),Et.fromBufferAttribute(n,r),St.fromBufferAttribute(n,c),l.uv=dt.getInterpolation(Mt,Fe,Ue,He,vt,Et,St,new H)),s&&(vt.fromBufferAttribute(s,o),Et.fromBufferAttribute(s,r),St.fromBufferAttribute(s,c),l.uv1=dt.getInterpolation(Mt,Fe,Ue,He,vt,Et,St,new H)),t&&(xs.fromBufferAttribute(t,o),As.fromBufferAttribute(t,r),bs.fromBufferAttribute(t,c),l.normal=dt.getInterpolation(Mt,Fe,Ue,He,xs,As,bs,new P),l.normal.dot(i.direction)>0&&l.normal.multiplyScalar(-1));const f={a:o,b:r,c,normal:new P,materialIndex:0};dt.getNormal(Fe,Ue,He,f.normal),l.face=f,l.faceIndex=o}return l}function Wt(i,e,t,n,s){const o=n*3;let r=o+0,c=o+1,a=o+2;const l=i.index;i.index&&(r=l.getX(r),c=l.getX(c),a=l.getX(a));const{position:f,normal:u,uv:d,uv1:h}=i.attributes,m=or(t,f,u,d,h,r,c,a,e);return m?(m.faceIndex=n,s&&s.push(m),m):null}function K(i,e,t,n){const s=i.a,o=i.b,r=i.c;let c=e,a=e+1,l=e+2;t&&(c=t.getX(c),a=t.getX(a),l=t.getX(l)),s.x=n.getX(c),s.y=n.getY(c),s.z=n.getZ(c),o.x=n.getX(a),o.y=n.getY(a),o.z=n.getZ(a),r.x=n.getX(l),r.y=n.getY(l),r.z=n.getZ(l)}function rr(i,e,t,n,s,o){const{geometry:r,_indirectBuffer:c}=i;for(let a=n,l=n+s;a<l;a++)Wt(r,e,t,a,o)}function ar(i,e,t,n,s){const{geometry:o,_indirectBuffer:r}=i;let c=1/0,a=null;for(let l=n,f=n+s;l<f;l++){let u;u=Wt(o,e,t,l),u&&u.distance<c&&(a=u,c=u.distance)}return a}function cr(i,e,t,n,s,o,r){const{geometry:c}=t,{index:a}=c,l=c.attributes.position;for(let f=i,u=e+i;f<u;f++){let d;if(d=f,K(r,d*3,a,l),r.needsUpdate=!0,n(r,d,s,o))return!0}return!1}function lr(i,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=i.geometry,n=t.index?t.index.array:null,s=t.attributes.position;let o,r,c,a,l=0;const f=i._roots;for(let d=0,h=f.length;d<h;d++)o=f[d],r=new Uint32Array(o),c=new Uint16Array(o),a=new Float32Array(o),u(0,l),l+=o.byteLength;function u(d,h,m=!1){const x=d*2;if(c[x+15]===Xt){const y=r[d+6],g=c[x+14];let b=1/0,A=1/0,_=1/0,v=-1/0,T=-1/0,E=-1/0;for(let M=3*y,R=3*(y+g);M<R;M++){let L=n[M];const S=s.getX(L),C=s.getY(L),O=s.getZ(L);S<b&&(b=S),S>v&&(v=S),C<A&&(A=C),C>T&&(T=C),O<_&&(_=O),O>E&&(E=O)}return a[d+0]!==b||a[d+1]!==A||a[d+2]!==_||a[d+3]!==v||a[d+4]!==T||a[d+5]!==E?(a[d+0]=b,a[d+1]=A,a[d+2]=_,a[d+3]=v,a[d+4]=T,a[d+5]=E,!0):!1}else{const y=d+8,g=r[d+6],b=y+h,A=g+h;let _=m,v=!1,T=!1;e?_||(v=e.has(b),T=e.has(A),_=!v&&!T):(v=!0,T=!0);const E=_||v,M=_||T;let R=!1;E&&(R=u(y,h,_));let L=!1;M&&(L=u(g,h,_));const S=R||L;if(S)for(let C=0;C<3;C++){const O=y+C,D=g+C,B=a[O],ge=a[O+3],xe=a[D],fe=a[D+3];a[d+C]=B<xe?B:xe,a[d+C+3]=ge>fe?ge:fe}return S}}}const _s=new Q;function Se(i,e,t,n){return U(i,e,_s),t.intersectBox(_s,n)}function ur(i,e,t,n,s,o){const{geometry:r,_indirectBuffer:c}=i;for(let a=n,l=n+s;a<l;a++){let f=c?c[a]:a;Wt(r,e,t,f,o)}}function fr(i,e,t,n,s){const{geometry:o,_indirectBuffer:r}=i;let c=1/0,a=null;for(let l=n,f=n+s;l<f;l++){let u;u=Wt(o,e,t,r?r[l]:l),u&&u.distance<c&&(a=u,c=u.distance)}return a}function dr(i,e,t,n,s,o,r){const{geometry:c}=t,{index:a}=c,l=c.attributes.position;for(let f=i,u=e+i;f<u;f++){let d;if(d=t.resolveTriangleIndex(f),K(r,d*3,a,l),r.needsUpdate=!0,n(r,d,s,o))return!0}return!1}const ws=new P;function hr(i,e,t,n,s){F.setBuffer(i._roots[e]),Sn(0,i,t,n,s),F.clearBuffer()}function Sn(i,e,t,n,s){const{float32Array:o,uint16Array:r,uint32Array:c}=F,a=i*2;if($(a,r)){const f=Z(i,c),u=ne(a,r);rr(e,t,n,f,u,s)}else{const f=se(i);Se(f,o,n,ws)&&Sn(f,e,t,n,s);const u=ie(i,c);Se(u,o,n,ws)&&Sn(u,e,t,n,s)}}const Ts=new P,pr=["x","y","z"];function mr(i,e,t,n){F.setBuffer(i._roots[e]);const s=Mn(0,i,t,n);return F.clearBuffer(),s}function Mn(i,e,t,n){const{float32Array:s,uint16Array:o,uint32Array:r}=F;let c=i*2;if($(c,o)){const l=Z(i,r),f=ne(c,o);return ar(e,t,n,l,f)}else{const l=hi(i,r),f=pr[l],d=n.direction[f]>=0;let h,m;d?(h=se(i),m=ie(i,r)):(h=ie(i,r),m=se(i));const p=Se(h,s,n,Ts)?Mn(h,e,t,n):null;if(p){const b=p.point[f];if(d?b<=s[m+l]:b>=s[m+l+3])return p}const g=Se(m,s,n,Ts)?Mn(m,e,t,n):null;return p&&g?p.distance<=g.distance?p:g:p||g||null}}const Pt=new Q,ze=new ae,je=new ae,it=new G,vs=new Y,Rt=new Y;function yr(i,e,t,n){F.setBuffer(i._roots[e]);const s=Pn(0,i,t,n);return F.clearBuffer(),s}function Pn(i,e,t,n,s=null){const{float32Array:o,uint16Array:r,uint32Array:c}=F;let a=i*2;if(s===null&&(t.boundingBox||t.computeBoundingBox(),vs.set(t.boundingBox.min,t.boundingBox.max,n),s=vs),$(a,r)){const f=e.geometry,u=f.index,d=f.attributes.position,h=t.index,m=t.attributes.position,x=Z(i,c),p=ne(a,r);if(it.copy(n).invert(),t.boundsTree)return U(i,o,Rt),Rt.matrix.copy(it),Rt.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>Rt.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(n),g.b.applyMatrix4(n),g.c.applyMatrix4(n),g.needsUpdate=!0;for(let b=x*3,A=(p+x)*3;b<A;b+=3)if(K(je,b,u,d),je.needsUpdate=!0,g.intersectsTriangle(je))return!0;return!1}});for(let y=x*3,g=(p+x)*3;y<g;y+=3){K(ze,y,u,d),ze.a.applyMatrix4(it),ze.b.applyMatrix4(it),ze.c.applyMatrix4(it),ze.needsUpdate=!0;for(let b=0,A=h.count;b<A;b+=3)if(K(je,b,h,m),je.needsUpdate=!0,ze.intersectsTriangle(je))return!0}}else{const f=i+8,u=c[i+6];return U(f,o,Pt),!!(s.intersectsBox(Pt)&&Pn(f,e,t,n,s)||(U(u,o,Pt),s.intersectsBox(Pt)&&Pn(u,e,t,n,s)))}}const Lt=new G,rn=new Y,ot=new Y,gr=new P,xr=new P,Ar=new P,br=new P;function _r(i,e,t,n={},s={},o=0,r=1/0){e.boundingBox||e.computeBoundingBox(),rn.set(e.boundingBox.min,e.boundingBox.max,t),rn.needsUpdate=!0;const c=i.geometry,a=c.attributes.position,l=c.index,f=e.attributes.position,u=e.index,d=te.getPrimitive(),h=te.getPrimitive();let m=gr,x=xr,p=null,y=null;s&&(p=Ar,y=br);let g=1/0,b=null,A=null;return Lt.copy(t).invert(),ot.matrix.copy(Lt),i.shapecast({boundsTraverseOrder:_=>rn.distanceToBox(_),intersectsBounds:(_,v,T)=>T<g&&T<r?(v&&(ot.min.copy(_.min),ot.max.copy(_.max),ot.needsUpdate=!0),!0):!1,intersectsRange:(_,v)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:E=>ot.distanceToBox(E),intersectsBounds:(E,M,R)=>R<g&&R<r,intersectsRange:(E,M)=>{for(let R=E,L=E+M;R<L;R++){K(h,3*R,u,f),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let S=_,C=_+v;S<C;S++){K(d,3*S,l,a),d.needsUpdate=!0;const O=d.distanceToTriangle(h,m,p);if(O<g&&(x.copy(m),y&&y.copy(p),g=O,b=S,A=R),O<o)return!0}}}});{const T=Qe(e);for(let E=0,M=T;E<M;E++){K(h,3*E,u,f),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let R=_,L=_+v;R<L;R++){K(d,3*R,l,a),d.needsUpdate=!0;const S=d.distanceToTriangle(h,m,p);if(S<g&&(x.copy(m),y&&y.copy(p),g=S,b=R,A=E),S<o)return!0}}}}}),te.releasePrimitive(d),te.releasePrimitive(h),g===1/0?null:(n.point?n.point.copy(x):n.point=x.clone(),n.distance=g,n.faceIndex=b,s&&(s.point?s.point.copy(y):s.point=y.clone(),s.point.applyMatrix4(Lt),x.applyMatrix4(Lt),s.distance=x.sub(s.point).length(),s.faceIndex=A),n)}function wr(i,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=i.geometry,n=t.index?t.index.array:null,s=t.attributes.position;let o,r,c,a,l=0;const f=i._roots;for(let d=0,h=f.length;d<h;d++)o=f[d],r=new Uint32Array(o),c=new Uint16Array(o),a=new Float32Array(o),u(0,l),l+=o.byteLength;function u(d,h,m=!1){const x=d*2;if(c[x+15]===Xt){const y=r[d+6],g=c[x+14];let b=1/0,A=1/0,_=1/0,v=-1/0,T=-1/0,E=-1/0;for(let M=y,R=y+g;M<R;M++){const L=3*i.resolveTriangleIndex(M);for(let S=0;S<3;S++){let C=L+S;C=n?n[C]:C;const O=s.getX(C),D=s.getY(C),B=s.getZ(C);O<b&&(b=O),O>v&&(v=O),D<A&&(A=D),D>T&&(T=D),B<_&&(_=B),B>E&&(E=B)}}return a[d+0]!==b||a[d+1]!==A||a[d+2]!==_||a[d+3]!==v||a[d+4]!==T||a[d+5]!==E?(a[d+0]=b,a[d+1]=A,a[d+2]=_,a[d+3]=v,a[d+4]=T,a[d+5]=E,!0):!1}else{const y=d+8,g=r[d+6],b=y+h,A=g+h;let _=m,v=!1,T=!1;e?_||(v=e.has(b),T=e.has(A),_=!v&&!T):(v=!0,T=!0);const E=_||v,M=_||T;let R=!1;E&&(R=u(y,h,_));let L=!1;M&&(L=u(g,h,_));const S=R||L;if(S)for(let C=0;C<3;C++){const O=y+C,D=g+C,B=a[O],ge=a[O+3],xe=a[D],fe=a[D+3];a[d+C]=B<xe?B:xe,a[d+C+3]=ge>fe?ge:fe}return S}}}const Es=new P;function Tr(i,e,t,n,s){F.setBuffer(i._roots[e]),Rn(0,i,t,n,s),F.clearBuffer()}function Rn(i,e,t,n,s){const{float32Array:o,uint16Array:r,uint32Array:c}=F,a=i*2;if($(a,r)){const f=Z(i,c),u=ne(a,r);ur(e,t,n,f,u,s)}else{const f=se(i);Se(f,o,n,Es)&&Rn(f,e,t,n,s);const u=ie(i,c);Se(u,o,n,Es)&&Rn(u,e,t,n,s)}}const Ss=new P,vr=["x","y","z"];function Er(i,e,t,n){F.setBuffer(i._roots[e]);const s=Ln(0,i,t,n);return F.clearBuffer(),s}function Ln(i,e,t,n){const{float32Array:s,uint16Array:o,uint32Array:r}=F;let c=i*2;if($(c,o)){const l=Z(i,r),f=ne(c,o);return fr(e,t,n,l,f)}else{const l=hi(i,r),f=vr[l],d=n.direction[f]>=0;let h,m;d?(h=se(i),m=ie(i,r)):(h=ie(i,r),m=se(i));const p=Se(h,s,n,Ss)?Ln(h,e,t,n):null;if(p){const b=p.point[f];if(d?b<=s[m+l]:b>=s[m+l+3])return p}const g=Se(m,s,n,Ss)?Ln(m,e,t,n):null;return p&&g?p.distance<=g.distance?p:g:p||g||null}}const Ct=new Q,Ke=new ae,Ve=new ae,rt=new G,Ms=new Y,It=new Y;function Sr(i,e,t,n){F.setBuffer(i._roots[e]);const s=Cn(0,i,t,n);return F.clearBuffer(),s}function Cn(i,e,t,n,s=null){const{float32Array:o,uint16Array:r,uint32Array:c}=F;let a=i*2;if(s===null&&(t.boundingBox||t.computeBoundingBox(),Ms.set(t.boundingBox.min,t.boundingBox.max,n),s=Ms),$(a,r)){const f=e.geometry,u=f.index,d=f.attributes.position,h=t.index,m=t.attributes.position,x=Z(i,c),p=ne(a,r);if(rt.copy(n).invert(),t.boundsTree)return U(i,o,It),It.matrix.copy(rt),It.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>It.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(n),g.b.applyMatrix4(n),g.c.applyMatrix4(n),g.needsUpdate=!0;for(let b=x,A=p+x;b<A;b++)if(K(Ve,3*e.resolveTriangleIndex(b),u,d),Ve.needsUpdate=!0,g.intersectsTriangle(Ve))return!0;return!1}});for(let y=x,g=p+x;y<g;y++){const b=e.resolveTriangleIndex(y);K(Ke,3*b,u,d),Ke.a.applyMatrix4(rt),Ke.b.applyMatrix4(rt),Ke.c.applyMatrix4(rt),Ke.needsUpdate=!0;for(let A=0,_=h.count;A<_;A+=3)if(K(Ve,A,h,m),Ve.needsUpdate=!0,Ke.intersectsTriangle(Ve))return!0}}else{const f=i+8,u=c[i+6];return U(f,o,Ct),!!(s.intersectsBox(Ct)&&Cn(f,e,t,n,s)||(U(u,o,Ct),s.intersectsBox(Ct)&&Cn(u,e,t,n,s)))}}const Ot=new G,an=new Y,at=new Y,Mr=new P,Pr=new P,Rr=new P,Lr=new P;function Cr(i,e,t,n={},s={},o=0,r=1/0){e.boundingBox||e.computeBoundingBox(),an.set(e.boundingBox.min,e.boundingBox.max,t),an.needsUpdate=!0;const c=i.geometry,a=c.attributes.position,l=c.index,f=e.attributes.position,u=e.index,d=te.getPrimitive(),h=te.getPrimitive();let m=Mr,x=Pr,p=null,y=null;s&&(p=Rr,y=Lr);let g=1/0,b=null,A=null;return Ot.copy(t).invert(),at.matrix.copy(Ot),i.shapecast({boundsTraverseOrder:_=>an.distanceToBox(_),intersectsBounds:(_,v,T)=>T<g&&T<r?(v&&(at.min.copy(_.min),at.max.copy(_.max),at.needsUpdate=!0),!0):!1,intersectsRange:(_,v)=>{if(e.boundsTree){const T=e.boundsTree;return T.shapecast({boundsTraverseOrder:E=>at.distanceToBox(E),intersectsBounds:(E,M,R)=>R<g&&R<r,intersectsRange:(E,M)=>{for(let R=E,L=E+M;R<L;R++){const S=T.resolveTriangleIndex(R);K(h,3*S,u,f),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let C=_,O=_+v;C<O;C++){const D=i.resolveTriangleIndex(C);K(d,3*D,l,a),d.needsUpdate=!0;const B=d.distanceToTriangle(h,m,p);if(B<g&&(x.copy(m),y&&y.copy(p),g=B,b=C,A=R),B<o)return!0}}}})}else{const T=Qe(e);for(let E=0,M=T;E<M;E++){K(h,3*E,u,f),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let R=_,L=_+v;R<L;R++){const S=i.resolveTriangleIndex(R);K(d,3*S,l,a),d.needsUpdate=!0;const C=d.distanceToTriangle(h,m,p);if(C<g&&(x.copy(m),y&&y.copy(p),g=C,b=R,A=E),C<o)return!0}}}}}),te.releasePrimitive(d),te.releasePrimitive(h),g===1/0?null:(n.point?n.point.copy(x):n.point=x.clone(),n.distance=g,n.faceIndex=b,s&&(s.point?s.point.copy(y):s.point=y.clone(),s.point.applyMatrix4(Ot),x.applyMatrix4(Ot),s.distance=x.sub(s.point).length(),s.faceIndex=A),n)}function Ir(){return typeof SharedArrayBuffer<"u"}const pt=new F.constructor,Kt=new F.constructor,we=new jn(()=>new Q),Ge=new Q,Xe=new Q,cn=new Q,ln=new Q;let un=!1;function Or(i,e,t,n){if(un)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");un=!0;const s=i._roots,o=e._roots;let r,c=0,a=0;const l=new G().copy(t).invert();for(let f=0,u=s.length;f<u;f++){pt.setBuffer(s[f]),a=0;const d=we.getPrimitive();U(0,pt.float32Array,d),d.applyMatrix4(l);for(let h=0,m=o.length;h<m&&(Kt.setBuffer(o[f]),r=oe(0,0,t,l,n,c,a,0,0,d),Kt.clearBuffer(),a+=o[h].length,!r);h++);if(we.releasePrimitive(d),pt.clearBuffer(),c+=s[f].length,r)break}return un=!1,r}function oe(i,e,t,n,s,o=0,r=0,c=0,a=0,l=null,f=!1){let u,d;f?(u=Kt,d=pt):(u=pt,d=Kt);const h=u.float32Array,m=u.uint32Array,x=u.uint16Array,p=d.float32Array,y=d.uint32Array,g=d.uint16Array,b=i*2,A=e*2,_=$(b,x),v=$(A,g);let T=!1;if(v&&_)f?T=s(Z(e,y),ne(e*2,g),Z(i,m),ne(i*2,x),a,r+e,c,o+i):T=s(Z(i,m),ne(i*2,x),Z(e,y),ne(e*2,g),c,o+i,a,r+e);else if(v){const E=we.getPrimitive();U(e,p,E),E.applyMatrix4(t);const M=se(i),R=ie(i,m);U(M,h,Ge),U(R,h,Xe);const L=E.intersectsBox(Ge),S=E.intersectsBox(Xe);T=L&&oe(e,M,n,t,s,r,o,a,c+1,E,!f)||S&&oe(e,R,n,t,s,r,o,a,c+1,E,!f),we.releasePrimitive(E)}else{const E=se(e),M=ie(e,y);U(E,p,cn),U(M,p,ln);const R=l.intersectsBox(cn),L=l.intersectsBox(ln);if(R&&L)T=oe(i,E,t,n,s,o,r,c,a+1,l,f)||oe(i,M,t,n,s,o,r,c,a+1,l,f);else if(R)if(_)T=oe(i,E,t,n,s,o,r,c,a+1,l,f);else{const S=we.getPrimitive();S.copy(cn).applyMatrix4(t);const C=se(i),O=ie(i,m);U(C,h,Ge),U(O,h,Xe);const D=S.intersectsBox(Ge),B=S.intersectsBox(Xe);T=D&&oe(E,C,n,t,s,r,o,a,c+1,S,!f)||B&&oe(E,O,n,t,s,r,o,a,c+1,S,!f),we.releasePrimitive(S)}else if(L)if(_)T=oe(i,M,t,n,s,o,r,c,a+1,l,f);else{const S=we.getPrimitive();S.copy(ln).applyMatrix4(t);const C=se(i),O=ie(i,m);U(C,h,Ge),U(O,h,Xe);const D=S.intersectsBox(Ge),B=S.intersectsBox(Xe);T=D&&oe(M,C,n,t,s,r,o,a,c+1,S,!f)||B&&oe(M,O,n,t,s,r,o,a,c+1,S,!f),we.releasePrimitive(S)}}return T}const Nt=new Y,Ps=new Q;class Kn{static serialize(e,t={}){t={cloneBuffers:!0,...t};const n=e.geometry,s=e._roots,o=e._indirectBuffer,r=n.getIndex();let c;return t.cloneBuffers?c={roots:s.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:o?o.slice():null}:c={roots:s,index:r.array,indirectBuffer:o},c}static deserialize(e,t,n={}){n={setIndex:!0,indirect:!!e.indirectBuffer,...n};const{index:s,roots:o,indirectBuffer:r}=e,c=new Kn(t,{...n,[tn]:!0});if(c._roots=o,c._indirectBuffer=r||null,n.setIndex){const a=t.getIndex();if(a===null){const l=new Ee(e.index,1,!1);t.setIndex(l)}else a.array!==s&&(a.array.set(s),a.needsUpdate=!0)}return c}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:ui,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[tn]:!1},t),t.useSharedArrayBuffer&&!Ir())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[tn]||($o(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Q)));const{_indirectBuffer:n}=this;this.resolveTriangleIndex=t.indirect?s=>n[s]:s=>s}refit(e=null){return(this.indirect?wr:lr)(this,e)}traverse(e,t=0){const n=this._roots[t],s=new Uint32Array(n),o=new Uint16Array(n);r(0);function r(c,a=0){const l=c*2,f=o[l+15]===Xt;if(f){const u=s[c+6],d=o[l+14];e(a,f,new Float32Array(n,c*4,6),u,d)}else{const u=c+Ut/4,d=s[c+6],h=s[c+7];e(a,f,new Float32Array(n,c*4,6),h)||(r(u,a+1),r(d,a+1))}}}raycast(e,t=bn){const n=this._roots,s=this.geometry,o=[],r=t.isMaterial,c=Array.isArray(t),a=s.groups,l=r?t.side:t,f=this.indirect?Tr:hr;for(let u=0,d=n.length;u<d;u++){const h=c?t[a[u].materialIndex].side:l,m=o.length;if(f(this,u,h,e,o),c){const x=a[u].materialIndex;for(let p=m,y=o.length;p<y;p++)o[p].face.materialIndex=x}}return o}raycastFirst(e,t=bn){const n=this._roots,s=this.geometry,o=t.isMaterial,r=Array.isArray(t);let c=null;const a=s.groups,l=o?t.side:t,f=this.indirect?Er:mr;for(let u=0,d=n.length;u<d;u++){const h=r?t[a[u].materialIndex].side:l,m=f(this,u,h,e);m!=null&&(c==null||m.distance<c.distance)&&(c=m,r&&(m.face.materialIndex=a[u].materialIndex))}return c}intersectsGeometry(e,t){let n=!1;const s=this._roots,o=this.indirect?Sr:yr;for(let r=0,c=s.length;r<c&&(n=o(this,r,e,t),!n);r++);return n}shapecast(e){const t=te.getPrimitive(),n=this.indirect?dr:cr;let{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:r,intersectsTriangle:c}=e;if(r&&c){const u=r;r=(d,h,m,x,p)=>u(d,h,m,x,p)?!0:n(d,h,this,c,m,x,t)}else r||(c?r=(u,d,h,m)=>n(u,d,this,c,h,m,t):r=(u,d,h)=>h);let a=!1,l=0;const f=this._roots;for(let u=0,d=f.length;u<d;u++){const h=f[u];if(a=nr(this,u,o,r,s,l),a)break;l+=h.byteLength}return te.releasePrimitive(t),a}bvhcast(e,t,n){let{intersectsRanges:s,intersectsTriangles:o}=n;const r=te.getPrimitive(),c=this.geometry.index,a=this.geometry.attributes.position,l=this.indirect?m=>{const x=this.resolveTriangleIndex(m);K(r,x*3,c,a)}:m=>{K(r,m*3,c,a)},f=te.getPrimitive(),u=e.geometry.index,d=e.geometry.attributes.position,h=e.indirect?m=>{const x=e.resolveTriangleIndex(m);K(f,x*3,u,d)}:m=>{K(f,m*3,u,d)};if(o){const m=(x,p,y,g,b,A,_,v)=>{for(let T=y,E=y+g;T<E;T++){h(T),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let M=x,R=x+p;M<R;M++)if(l(M),r.needsUpdate=!0,o(r,f,M,T,b,A,_,v))return!0}return!1};if(s){const x=s;s=function(p,y,g,b,A,_,v,T){return x(p,y,g,b,A,_,v,T)?!0:m(p,y,g,b,A,_,v,T)}}else s=m}return Or(this,e,t,s)}intersectsBox(e,t){return Nt.set(e.min,e.max,t),Nt.needsUpdate=!0,this.shapecast({intersectsBounds:n=>Nt.intersectsBox(n),intersectsTriangle:n=>Nt.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},s={},o=0,r=1/0){return(this.indirect?Cr:_r)(this,e,t,n,s,o,r)}closestPointToPoint(e,t={},n=0,s=1/0){return sr(this,e,t,n,s)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(n=>{U(0,new Float32Array(n),Ps),e.union(Ps)}),e}}const Pe=new P,Re=new P,Le=new P,Rs=new mt,Dt=new P,fn=new P,Ls=new mt,Cs=new mt,kt=new G,Is=new G;function ct(i,e){if(!i&&!e)return;const t=i.count===e.count,n=i.normalized===e.normalized,s=i.array.constructor===e.array.constructor,o=i.itemSize===e.itemSize;if(!t||!n||!s||!o)throw new Error}function ht(i,e=null){const t=i.array.constructor,n=i.normalized,s=i.itemSize,o=e===null?i.count:e;return new Ee(new t(s*o),s,n)}function pi(i,e,t=0){if(i.isInterleavedBufferAttribute){const n=i.itemSize;for(let s=0,o=i.count;s<o;s++){const r=s+t;e.setX(r,i.getX(s)),n>=2&&e.setY(r,i.getY(s)),n>=3&&e.setZ(r,i.getZ(s)),n>=4&&e.setW(r,i.getW(s))}}else{const n=e.array,s=n.constructor,o=n.BYTES_PER_ELEMENT*i.itemSize*t;new s(n.buffer,o,i.array.length).set(i.array)}}function Nr(i,e,t){const n=i.elements,s=e.elements;for(let o=0,r=s.length;o<r;o++)n[o]+=s[o]*t}function Os(i,e,t){const n=i.skeleton,s=i.geometry,o=n.bones,r=n.boneInverses;Ls.fromBufferAttribute(s.attributes.skinIndex,e),Cs.fromBufferAttribute(s.attributes.skinWeight,e),kt.elements.fill(0);for(let c=0;c<4;c++){const a=Cs.getComponent(c);if(a!==0){const l=Ls.getComponent(c);Is.multiplyMatrices(o[l].matrixWorld,r[l]),Nr(kt,Is,a)}}return kt.multiply(i.bindMatrix).premultiply(i.bindMatrixInverse),t.transformDirection(kt),t}function dn(i,e,t,n,s){Dt.set(0,0,0);for(let o=0,r=i.length;o<r;o++){const c=e[o],a=i[o];c!==0&&(fn.fromBufferAttribute(a,n),t?Dt.addScaledVector(fn,c):Dt.addScaledVector(fn.sub(s),c))}s.add(Dt)}function Dr(i,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},t=new qe){const n=i[0].index!==null,{useGroups:s=!1,updateIndex:o=!1,skipAttributes:r=[]}=e,c=new Set(Object.keys(i[0].attributes)),a={};let l=0;t.clearGroups();for(let f=0;f<i.length;++f){const u=i[f];let d=0;if(n!==(u.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const h in u.attributes){if(!c.has(h))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+h+'" attribute exists among all geometries, or in none of them.');a[h]===void 0&&(a[h]=[]),a[h].push(u.attributes[h]),d++}if(d!==c.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(s){let h;if(n)h=u.index.count;else if(u.attributes.position!==void 0)h=u.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");t.addGroup(l,h,f),l+=h}}if(n){let f=!1;if(!t.index){let u=0;for(let d=0;d<i.length;++d)u+=i[d].index.count;t.setIndex(new Ee(new Uint32Array(u),1,!1)),f=!0}if(o||f){const u=t.index;let d=0,h=0;for(let m=0;m<i.length;++m){const x=i[m],p=x.index;if(r[m]!==!0)for(let y=0;y<p.count;++y)u.setX(d,p.getX(y)+h),d++;h+=x.attributes.position.count}}}for(const f in a){const u=a[f];if(!(f in t.attributes)){let m=0;for(const x in u)m+=u[x].count;t.setAttribute(f,ht(a[f][0],m))}const d=t.attributes[f];let h=0;for(let m=0,x=u.length;m<x;m++){const p=u[m];r[m]!==!0&&pi(p,d,h),h+=p.count}}return t}function kr(i,e){if(i===null||e===null)return i===e;if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}class Br{constructor(e){this.matrixWorld=new G,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){const e=this.mesh,t=e.geometry,n=e.skeleton,s=(t.index?t.index.count:t.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=t.attributes.position.version,this.primitiveCount=s,n){n.boneTexture||n.computeBoneTexture(),n.update();const o=n.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==o.length?this.boneMatrices=o.slice():this.boneMatrices.set(o)}else this.boneMatrices=null}didChange(){const e=this.mesh,t=e.geometry,n=(t.index?t.index.count:t.attributes.position.count)/3;return!(this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===t.attributes.position.version&&kr(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===n)}}class Fr{constructor(e){Array.isArray(e)||(e=[e]);const t=[];e.forEach(n=>{n.traverseVisible(s=>{s.isMesh&&t.push(s)})}),this.meshes=t,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(t.length).fill().map(()=>new qe),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)}),e}generate(e=new qe){let t=[];const{meshes:n,useGroups:s,_intermediateGeometry:o,_diffMap:r}=this;for(let c=0,a=n.length;c<a;c++){const l=n[c],f=o[c],u=r.get(l);!u||u.didChange(l)?(this._convertToStaticGeometry(l,f),t.push(!1),u?u.update():r.set(l,new Br(l))):t.push(!0)}Dr(o,{useGroups:s,skipAttributes:t},e);for(const c in e.attributes)e.attributes[c].needsUpdate=!0;return e}_convertToStaticGeometry(e,t=new qe){const n=e.geometry,s=this.applyWorldTransforms,o=this.attributes.includes("normal"),r=this.attributes.includes("tangent"),c=n.attributes,a=t.attributes;t.index||(t.index=n.index),a.position||t.setAttribute("position",ht(c.position)),o&&!a.normal&&c.normal&&t.setAttribute("normal",ht(c.normal)),r&&!a.tangent&&c.tangent&&t.setAttribute("tangent",ht(c.tangent)),ct(n.index,t.index),ct(c.position,a.position),o&&ct(c.normal,a.normal),r&&ct(c.tangent,a.tangent);const l=c.position,f=o?c.normal:null,u=r?c.tangent:null,d=n.morphAttributes.position,h=n.morphAttributes.normal,m=n.morphAttributes.tangent,x=n.morphTargetsRelative,p=e.morphTargetInfluences,y=new Ui;y.getNormalMatrix(e.matrixWorld);for(let g=0,b=c.position.count;g<b;g++)Pe.fromBufferAttribute(l,g),f&&Re.fromBufferAttribute(f,g),u&&(Rs.fromBufferAttribute(u,g),Le.fromBufferAttribute(u,g)),p&&(d&&dn(d,p,x,g,Pe),h&&dn(h,p,x,g,Re),m&&dn(m,p,x,g,Le)),e.isSkinnedMesh&&(e.applyBoneTransform(g,Pe),f&&Os(e,g,Re),u&&Os(e,g,Le)),s&&Pe.applyMatrix4(e.matrixWorld),a.position.setXYZ(g,Pe.x,Pe.y,Pe.z),f&&(s&&Re.applyNormalMatrix(y),a.normal.setXYZ(g,Re.x,Re.y,Re.z)),u&&(s&&Le.transformDirection(e.matrixWorld),a.tangent.setXYZW(g,Le.x,Le.y,Le.z,Rs.w));for(const g in this.attributes){const b=this.attributes[g];b==="position"||b==="tangent"||b==="normal"||!(b in c)||(a[b]||t.setAttribute(b,ht(c[b])),ct(c[b],a[b]),pi(c[b],a[b]))}return t}}class Yt extends Ze{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Bn;const n=this,s=t.color!==void 0?new le(t.color):new le(8355711),o=t.textureWidth||512,r=t.textureHeight||512,c=t.clipBias||0,a=t.shader||Yt.ReflectorShader,l=t.multisample!==void 0?t.multisample:4,f=new Gt,u=new P,d=new P,h=new P,m=new G,x=new P(0,0,-1),p=new mt,y=new P,g=new P,b=new mt,A=new G,_=this.camera,v=new Hi(o,r,{samples:l,type:zi}),T=new ji({name:a.name!==void 0?a.name:"unspecified",uniforms:Ki.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});T.uniforms.tDiffuse.value=v.texture,T.uniforms.color.value=s,T.uniforms.textureMatrix.value=A,this.material=T,this.onBeforeRender=function(E,M,R){if(d.setFromMatrixPosition(n.matrixWorld),h.setFromMatrixPosition(R.matrixWorld),m.extractRotation(n.matrixWorld),u.set(0,0,1),u.applyMatrix4(m),y.subVectors(d,h),y.dot(u)>0)return;y.reflect(u).negate(),y.add(d),m.extractRotation(R.matrixWorld),x.set(0,0,-1),x.applyMatrix4(m),x.add(h),g.subVectors(d,x),g.reflect(u).negate(),g.add(d),_.position.copy(y),_.up.set(0,1,0),_.up.applyMatrix4(m),_.up.reflect(u),_.lookAt(g),_.far=R.far,_.updateMatrixWorld(),_.projectionMatrix.copy(R.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(_.projectionMatrix),A.multiply(_.matrixWorldInverse),A.multiply(n.matrixWorld),f.setFromNormalAndCoplanarPoint(u,d),f.applyMatrix4(_.matrixWorldInverse),p.set(f.normal.x,f.normal.y,f.normal.z,f.constant);const L=_.projectionMatrix;b.x=(Math.sign(p.x)+L.elements[8])/L.elements[0],b.y=(Math.sign(p.y)+L.elements[9])/L.elements[5],b.z=-1,b.w=(1+L.elements[10])/L.elements[14],p.multiplyScalar(2/p.dot(b)),L.elements[2]=p.x,L.elements[6]=p.y,L.elements[10]=p.z+1-c,L.elements[14]=p.w,n.visible=!1;const S=E.getRenderTarget(),C=E.xr.enabled,O=E.shadowMap.autoUpdate;E.xr.enabled=!1,E.shadowMap.autoUpdate=!1,E.setRenderTarget(v),E.state.buffers.depth.setMask(!0),E.autoClear===!1&&E.clear(),E.render(M,_),E.xr.enabled=C,E.shadowMap.autoUpdate=O,E.setRenderTarget(S);const D=R.viewport;D!==void 0&&E.state.viewport(D),n.visible=!0},this.getRenderTarget=function(){return v},this.dispose=function(){v.dispose(),n.material.dispose()}}}Yt.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 0.1 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class Ur{constructor(){I(this,"core");I(this,"loader");I(this,"collision_scene");I(this,"collider");I(this,"texture_boards",{});I(this,"gallery_boards",{});I(this,"raycast_objects",[]);I(this,"is_load_finished",!1);this.core=new ue,this.loader=this.core.loader,this._loadScenes()}async _loadScenes(){try{await this._loadSceneAndCollisionDetection(),await this._loadStaticScene(),await this._loadBoardsTexture(),this._configureGallery(),this._createSpecularReflection(),this.is_load_finished=!0,this.core.$emit($s)}catch(e){console.log(e)}}async _loadBoardsTexture(){for(let e=0;e<is.length;e++)this.texture_boards[e+1]=await this.loader.texture_loader.loadAsync(is[e]);for(const e in this.texture_boards){const t=this.texture_boards[e];t.colorSpace=Oe;const n=t.image.width/t.image.height;let s=1,o=1;n>1?s=1/n:o=n,t.offset.set(.5-s/2,.5-o/2),t.repeat.set(s,o),t.needsUpdate=!0}return Promise.resolve()}_configureGallery(){for(const e in this.texture_boards){const t=this.gallery_boards[`gallery${e}_board`],n=t.material;n.map=this.texture_boards[e],t.userData={name:t.name,title:Qt[e].title,author:Qt[e].author,describe:Qt[e].describe,index:e,src:this.texture_boards[e].image.src,show_boards:!0},[4,5,6,7,9].includes(+e)&&(t.rotation.y=-Math.PI/2),+e==8&&(t.rotation.y=Math.PI),n.needsUpdate=!0}}_createSpecularReflection(){const e=new Yt(new Fn(100,100),{textureWidth:window.innerWidth*window.devicePixelRatio,textureHeight:window.innerHeight*window.devicePixelRatio,color:16777215});e.material instanceof Ft&&(e.material.transparent=!0),e.rotation.x=-.5*Math.PI,this.core.scene.add(e)}_loadStaticScene(){return new Promise(e=>{this.loader.gltf_loader.load(os,t=>{this.core.scene.add(t.scene),t.scene.traverse(n=>{n.name==="computer"&&(n.userData={name:n.name,title:"스위스 하더 쿨름에서 🏞️"},this.raycast_objects.push(n))}),e()},t=>{this.core.$emit(zt,{url:os,loaded:t.loaded,total:t.total})})})}_loadSceneAndCollisionDetection(){return new Promise(e=>{this.loader.gltf_loader.load(rs,t=>{this.collision_scene=t.scene,this.collision_scene.updateMatrixWorld(!0),this.collision_scene.traverse(o=>{(o.name==="home001"||o.name==="PointLight")&&(o.castShadow=!0),o.name.includes("PointLight")&&Io(o)&&(o.intensity*=2e3),o.name==="home002"&&(o.castShadow=!0,o.receiveShadow=!0),/gallery.*_board/.test(o.name)&&Co(o)&&(this.gallery_boards[o.name]=o),this.raycast_objects.push(o)});const n=new Fr(this.collision_scene);n.attributes=["position"];const s=n.generate();s.boundsTree=new Kn(s,{lazyGeneration:!1}),this.collider=new Ze(s),this.core.scene.add(this.collision_scene),e()},t=>{this.core.$emit(zt,{url:rs,loaded:t.loaded,total:t.total})})})}}const lt=new P;function J(i,e,t,n,s,o){const r=2*Math.PI*s/4,c=Math.max(o-2*s,0),a=Math.PI/4;lt.copy(e),lt[n]=0,lt.normalize();const l=.5*r/(r+c),f=1-lt.angleTo(i)/a;return Math.sign(lt[t])===1?f*l:c/(r+c)+l+l*(1-f)}class Hr extends Vi{constructor(e=1,t=1,n=1,s=2,o=.1){if(s=s*2+1,o=Math.min(e/2,t/2,n/2,o),super(1,1,1,s,s,s),s===1)return;const r=this.toNonIndexed();this.index=null,this.attributes.position=r.attributes.position,this.attributes.normal=r.attributes.normal,this.attributes.uv=r.attributes.uv;const c=new P,a=new P,l=new P(e,t,n).divideScalar(2).subScalar(o),f=this.attributes.position.array,u=this.attributes.normal.array,d=this.attributes.uv.array,h=f.length/6,m=new P,x=.5/s;for(let p=0,y=0;p<f.length;p+=3,y+=2)switch(c.fromArray(f,p),a.copy(c),a.x-=Math.sign(a.x)*x,a.y-=Math.sign(a.y)*x,a.z-=Math.sign(a.z)*x,a.normalize(),f[p+0]=l.x*Math.sign(c.x)+a.x*o,f[p+1]=l.y*Math.sign(c.y)+a.y*o,f[p+2]=l.z*Math.sign(c.z)+a.z*o,u[p+0]=a.x,u[p+1]=a.y,u[p+2]=a.z,Math.floor(p/h)){case 0:m.set(1,0,0),d[y+0]=J(m,a,"z","y",o,n),d[y+1]=1-J(m,a,"y","z",o,t);break;case 1:m.set(-1,0,0),d[y+0]=1-J(m,a,"z","y",o,n),d[y+1]=1-J(m,a,"y","z",o,t);break;case 2:m.set(0,1,0),d[y+0]=1-J(m,a,"x","z",o,e),d[y+1]=J(m,a,"z","x",o,n);break;case 3:m.set(0,-1,0),d[y+0]=1-J(m,a,"x","z",o,e),d[y+1]=1-J(m,a,"z","x",o,n);break;case 4:m.set(0,0,1),d[y+0]=1-J(m,a,"x","y",o,e),d[y+1]=1-J(m,a,"y","x",o,t);break;case 5:m.set(0,0,-1),d[y+0]=J(m,a,"x","y",o,e),d[y+1]=1-J(m,a,"y","x",o,t);break}}}class zr{constructor({reset_position:e=new P(0,5,0),reset_y:t=-25,speed:n=6,jump_height:s=20,gravity:o=-50}){I(this,"core");I(this,"character");I(this,"capsule_info",{radius:1,segment:new re(new P,new P(0,-5,0))});I(this,"reset_position");I(this,"reset_y");I(this,"gravity");I(this,"jump_height");I(this,"speed");I(this,"player_is_on_ground",!1);I(this,"velocity",new P);I(this,"up_vector",new P(0,1,0));I(this,"temp_vector",new P);I(this,"temp_vector2",new P);I(this,"temp_box",new Q);I(this,"temp_mat",new G);I(this,"temp_segment",new re);this.core=new ue,this.reset_position=e,this.reset_y=t,this.gravity=o,this.jump_height=s,this.speed=n,this._createCharacter(),this.core.$on(Zs,this._onKeyDown.bind(this))}update(e,t){this._updateOrbitControls(),this._updateCharacter(e),this._checkCollision(e,t),this.core.camera.position.sub(this.core.orbit_controls.target),this.core.orbit_controls.target.copy(this.character.position),this.core.camera.position.add(this.character.position),this._checkReset()}_createCharacter(){this.character=new Ze(new Hr(.5,2.5,.5,10,1),new Ie({color:255})),this.character.geometry.translate(0,-.25,0),this.character.position.copy(this.reset_position),this.character.visible=!1,this.core.scene.add(this.character)}_checkCollision(e,t){var c,a;const n=this.capsule_info;this.temp_box.makeEmpty(),this.temp_mat.copy(t.matrixWorld).invert(),this.temp_segment.copy(n.segment),this.temp_segment.start.applyMatrix4(this.character.matrixWorld).applyMatrix4(this.temp_mat),this.temp_segment.end.applyMatrix4(this.character.matrixWorld).applyMatrix4(this.temp_mat),this.temp_box.expandByPoint(this.temp_segment.start),this.temp_box.expandByPoint(this.temp_segment.end),this.temp_box.min.addScalar(-n.radius),this.temp_box.max.addScalar(n.radius),(a=(c=t.geometry)==null?void 0:c.boundsTree)==null||a.shapecast({intersectsBounds:l=>l.intersectsBox(this.temp_box),intersectsTriangle:l=>{const f=this.temp_vector,u=this.temp_vector2,d=l.closestPointToSegment(this.temp_segment,f,u);if(d<n.radius){const h=n.radius-d,m=u.sub(f).normalize();this.temp_segment.start.addScaledVector(m,h),this.temp_segment.end.addScaledVector(m,h)}}});const s=this.temp_vector;s.copy(this.temp_segment.start).applyMatrix4(t.matrixWorld);const o=this.temp_vector2;o.subVectors(s,this.character.position),this.player_is_on_ground=o.y>Math.abs(e*this.velocity.y*.25);const r=Math.max(0,o.length()-1e-5);o.normalize().multiplyScalar(r),this.character.position.add(o),this.player_is_on_ground?this.velocity.set(0,0,0):(o.normalize(),this.velocity.addScaledVector(o,-o.dot(this.velocity)))}_checkReset(){this.character.position.y<this.reset_y&&this._reset()}_reset(){this.velocity.set(0,0,0),this.character.position.copy(this.reset_position),this.core.camera.position.sub(this.core.orbit_controls.target),this.core.orbit_controls.target.copy(this.character.position),this.core.camera.position.add(this.character.position),this.core.orbit_controls.update()}_updateCharacter(e){this.velocity.y+=this.player_is_on_ground?0:e*this.gravity,this.character.position.addScaledVector(this.velocity,e);const t=this.core.orbit_controls.getAzimuthalAngle();if(this.core.control_manage.mode==="pc")this.core.control_manage.key_status.KeyW&&(this.temp_vector.set(0,0,-1).applyAxisAngle(this.up_vector,t),this.character.position.addScaledVector(this.temp_vector,this.speed*e)),this.core.control_manage.key_status.KeyS&&(this.temp_vector.set(0,0,1).applyAxisAngle(this.up_vector,t),this.character.position.addScaledVector(this.temp_vector,this.speed*e)),this.core.control_manage.key_status.KeyA&&(this.temp_vector.set(-1,0,0).applyAxisAngle(this.up_vector,t),this.character.position.addScaledVector(this.temp_vector,this.speed*e)),this.core.control_manage.key_status.KeyD&&(this.temp_vector.set(1,0,0).applyAxisAngle(this.up_vector,t),this.character.position.addScaledVector(this.temp_vector,this.speed*e));else{const n=this.core.control_manage.move_degree;if(n){const s=(n-90)*(Math.PI/180);this.temp_vector.set(0,0,-1).applyAxisAngle(this.up_vector,s),this.temp_vector.applyQuaternion(this.core.camera.quaternion),this.character.position.addScaledVector(this.temp_vector,this.speed*e)}}this.character.updateMatrixWorld()}_updateOrbitControls(){this.core.orbit_controls.maxPolarAngle=Math.PI,this.core.orbit_controls.minDistance=1e-4,this.core.orbit_controls.maxDistance=1e-4}_onKeyDown([e]){e==="Space"&&this._onCharacterJump()}_onCharacterJump(){this.player_is_on_ground&&(this.velocity.y=this.jump_height)}}const Ns=new P,jr=new yt,Ds=new P;class Kr extends Un{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const ce=new G,Vr=new G;class Gr{constructor(e={}){const t=this;let n,s,o,r;const c={camera:{fov:0,style:""},objects:new WeakMap},a=e.element!==void 0?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",a.appendChild(l);const f=document.createElement("div");f.style.transformStyle="preserve-3d",l.appendChild(f),this.getSize=function(){return{width:n,height:s}},this.render=function(x,p){const y=p.projectionMatrix.elements[5]*r;c.camera.fov!==y&&(l.style.perspective=p.isPerspectiveCamera?y+"px":"",c.camera.fov=y),p.view&&p.view.enabled?(l.style.transform=`translate( ${-p.view.offsetX*(n/p.view.width)}px, ${-p.view.offsetY*(s/p.view.height)}px )`,l.style.transform+=`scale( ${p.view.fullWidth/p.view.width}, ${p.view.fullHeight/p.view.height} )`):l.style.transform="",x.matrixWorldAutoUpdate===!0&&x.updateMatrixWorld(),p.parent===null&&p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld();let g,b;p.isOrthographicCamera&&(g=-(p.right+p.left)/2,b=(p.top+p.bottom)/2);const A=p.view&&p.view.enabled?p.view.height/p.view.fullHeight:1,v=(p.isOrthographicCamera?`scale( ${A} )scale(`+y+")translate("+u(g)+"px,"+u(b)+"px)"+d(p.matrixWorldInverse):`scale( ${A} )translateZ(`+y+"px)"+d(p.matrixWorldInverse))+"translate("+o+"px,"+r+"px)";c.camera.style!==v&&(f.style.transform=v,c.camera.style=v),m(x,x,p)},this.setSize=function(x,p){n=x,s=p,o=n/2,r=s/2,a.style.width=x+"px",a.style.height=p+"px",l.style.width=x+"px",l.style.height=p+"px",f.style.width=x+"px",f.style.height=p+"px"};function u(x){return Math.abs(x)<1e-10?0:x}function d(x){const p=x.elements;return"matrix3d("+u(p[0])+","+u(-p[1])+","+u(p[2])+","+u(p[3])+","+u(p[4])+","+u(-p[5])+","+u(p[6])+","+u(p[7])+","+u(p[8])+","+u(-p[9])+","+u(p[10])+","+u(p[11])+","+u(p[12])+","+u(-p[13])+","+u(p[14])+","+u(p[15])+")"}function h(x){const p=x.elements;return"translate(-50%,-50%)"+("matrix3d("+u(p[0])+","+u(p[1])+","+u(p[2])+","+u(p[3])+","+u(-p[4])+","+u(-p[5])+","+u(-p[6])+","+u(-p[7])+","+u(p[8])+","+u(p[9])+","+u(p[10])+","+u(p[11])+","+u(p[12])+","+u(p[13])+","+u(p[14])+","+u(p[15])+")")}function m(x,p,y,g){if(x.isCSS3DObject){const b=x.visible===!0&&x.layers.test(y.layers)===!0;if(x.element.style.display=b===!0?"":"none",b===!0){x.onBeforeRender(t,p,y);let A;x.isCSS3DSprite?(ce.copy(y.matrixWorldInverse),ce.transpose(),x.rotation2D!==0&&ce.multiply(Vr.makeRotationZ(x.rotation2D)),x.matrixWorld.decompose(Ns,jr,Ds),ce.setPosition(Ns),ce.scale(Ds),ce.elements[3]=0,ce.elements[7]=0,ce.elements[11]=0,ce.elements[15]=1,A=h(ce)):A=h(x.matrixWorld);const _=x.element,v=c.objects.get(x);if(v===void 0||v.style!==A){_.style.transform=A;const T={style:A};c.objects.set(x,T)}_.parentNode!==f&&f.appendChild(_),x.onAfterRender(t,p,y)}}for(let b=0,A=x.children.length;b<A;b++)m(x.children[b],p,y)}}}class Xr{constructor(){I(this,"core");I(this,"css_scene");I(this,"css_renderer");this.core=new ue,this.css_scene=new Qs,this.css_renderer=new Gr,this._initRenderer(),this._initResponsiveResize(),this._createCssObj()}update(){this.css_renderer.render(this.css_scene,this.core.camera)}_initRenderer(){var e;this.css_renderer.setSize(window.innerWidth,window.innerHeight),this.css_renderer.domElement.style.position="absolute",this.css_renderer.domElement.style.top="0px",(e=document.querySelector("#css"))==null||e.appendChild(this.css_renderer.domElement)}_initResponsiveResize(){window.addEventListener("resize",()=>{this.css_renderer.setSize(window.innerWidth,window.innerHeight)})}_createCssObj(){const e=new Hn({color:0});e.side=kn,e.transparent=!0,e.opacity=0,e.blending=Gi;const t=new Fn(1.5,1.3),n=new Ze(t,e);n.position.set(-15.55,5.5,36.33),n.rotation.set(0,Math.PI/2,0),this.core.scene.add(n);const s=document.createElement("video");s.src="IMG_0409.mp4",s.style.width="1200px",s.style.height="900px",s.style.boxSizing="border-box",s.style.opacity="1",s.autoplay=!0,s.loop=!0,s.muted=!0,s.playsInline=!0,s.controls=!0;const o=new Kr(s);o.position.copy(n.position),o.rotation.copy(n.rotation),o.scale.set(.002,.002,.002),this.css_scene.add(o);const r=()=>{window.innerWidth<600?(s.style.width="600px",s.style.height="100%",o.scale.set(.003,.004,.003)):(s.style.width="1200px",s.style.height="900px",o.scale.set(.002,.002,.002))};r(),window.addEventListener("resize",r)}}class Wr extends Js{constructor(e,t=1,n=16,s=2){const o=new qe,r=n+s*2,c=new Float32Array((r*3+3)*3);o.setAttribute("position",new Ee(c,3));const a=new _n({color:65280}),l=new _n({color:16776960});super(o,[l,a]),this.audio=e,this.range=t,this.divisionsInnerAngle=n,this.divisionsOuterAngle=s,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,n=this.divisionsInnerAngle,s=this.divisionsOuterAngle,o=jt.degToRad(e.panner.coneInnerAngle),r=jt.degToRad(e.panner.coneOuterAngle),c=o/2,a=r/2;let l=0,f=0,u,d;const h=this.geometry,m=h.attributes.position;h.clearGroups();function x(p,y,g,b){const A=(y-p)/g;for(m.setXYZ(l,0,0,0),f++,u=p;u<y;u+=A)d=l+f,m.setXYZ(d,Math.sin(u)*t,0,Math.cos(u)*t),m.setXYZ(d+1,Math.sin(Math.min(u+A,y))*t,0,Math.cos(Math.min(u+A,y))*t),m.setXYZ(d+2,0,0,0),f+=3;h.addGroup(l,f,b),l+=f,f=0}x(-a,-c,s,0),x(-c,c,n,1),x(c,a,s,0),m.needsUpdate=!0,o===r&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}class Yr{constructor(){I(this,"core");I(this,"audio_mesh");I(this,"positional_audio");this.core=new ue}async createAudio(){this.audio_mesh=new Ze(new Fn(1,1),new Ie({color:16711680})),this.audio_mesh.position.set(-15.9,4.49,36.42),this.audio_mesh.visible=!1,this.core.scene.add(this.audio_mesh);const e=new Xi;this.core.camera.add(e),this.positional_audio=new Wi(e),this.audio_mesh.add(this.positional_audio);const t=await this.core.loader.audio_loader.loadAsync(Yi);this.positional_audio.setBuffer(t),this.positional_audio.setVolume(.8),this.positional_audio.setRefDistance(2),this.positional_audio.setDirectionalCone(180,230,.5),this.positional_audio.setLoop(!0);const n=new Wr(this.positional_audio);return this.positional_audio.add(n),Promise.resolve()}playAudio(){var e;(e=this.positional_audio)==null||e.play()}}class qr{constructor(){I(this,"core");I(this,"click_raycaster");I(this,"tooltip_raycaster");I(this,"hover_point");I(this,"mouse_point");this.core=new ue,this.click_raycaster=new as,this.click_raycaster.far=18,this.tooltip_raycaster=new as,this.tooltip_raycaster.far=15,this.hover_point=new H(0,0),this.mouse_point=new H}updateTooltipRayCast(e=[]){if(e.length){this.tooltip_raycaster.setFromCamera(this.hover_point,this.core.camera);const t=this.tooltip_raycaster.intersectObjects(e);t.length&&t[0].object.userData.title?this.core.$emit(ei,{msg:t[0].object.userData.title,show_preview_tips:!!t[0].object.userData.show_boards}):this.core.$emit(ti)}}bindClickRayCastObj(e=[]){let t=0,n=0;document.body.addEventListener("pointerdown",s=>{t=s.screenX,n=s.screenY}),document.body.addEventListener("pointerup",s=>{const o=Math.abs(s.screenX-t),r=Math.abs(s.screenY-n);if(o<=1&&r<=1&&s.target instanceof HTMLCanvasElement){this.mouse_point.x=s.clientX/window.innerWidth*2-1,this.mouse_point.y=-(s.clientY/window.innerHeight*2-1),this.click_raycaster.setFromCamera(this.mouse_point,this.core.camera);const c=this.click_raycaster.intersectObjects(e);c.length&&c[0].object.userData.show_boards&&this.core.$emit(ni,c[0].object)}})}}class $r{constructor(){I(this,"core");I(this,"environment");I(this,"character");I(this,"css_3d_renderer");I(this,"audio");I(this,"ray_caster_controls");this.core=new ue,this.core.$on(zt,this._handleLoadProgress.bind(this)),this.core.$on($s,this._onLoadModelFinish.bind(this)),this.core.$on(ni,this._onClickRayCast.bind(this)),this.core.$on(ei,this._onShowTooltip.bind(this)),this.core.$on(ti,this._onHideTooltip.bind(this)),this.core.$on(si,this._onEnterApp.bind(this)),this.environment=new Ur,this.character=new zr({speed:12}),this.css_3d_renderer=new Xr,this.audio=new Yr,this.ray_caster_controls=new qr}update(e){this.environment.collider&&this.environment.is_load_finished&&(this.css_3d_renderer.update(),this.character.update(e,this.environment.collider),this.ray_caster_controls.updateTooltipRayCast(this.environment.raycast_objects))}_onEnterApp(){this.audio.playAudio(),this.core.control_manage.enabled()}async _onLoadModelFinish(){await this.audio.createAudio(),this.core.ui.removeLoading(),this.core.ui.showLoadingConfirm(),this.ray_caster_controls.bindClickRayCastObj(this.environment.raycast_objects)}_handleLoadProgress([{url:e,loaded:t,total:n}]){const s=(t/n*100).toFixed(2);/.*\.(blob|glb)$/i.test(e)&&this.core.ui.updateLoadingProgress(`${e.includes("collision")?"충돌 장면 모델 로드 중":"다른 장면 모델 로드 중"}：${s}%`),/.*\.(jpg|png|jpeg)$/i.test(e)&&this.core.ui.updateLoadingProgress("이미지 리소스 로드 중..."),/.*\.(m4a|mp3)$/i.test(e)&&this.core.ui.updateLoadingProgress("오디오 리소스 로드 중...")}_onClickRayCast([e]){this.core.ui.showBoardsBox(e.userData.title,e.userData.author,e.userData.describe,e.userData.src)}_onShowTooltip([{msg:e,show_preview_tips:t}]){this.core.ui.showPreviewTooltip(e,t)}_onHideTooltip(){this.core.ui.hidePreviewTooltip()}}function Zr(i){return{all:i=i||new Map,on:function(e,t){var n=i.get(e);n?n.push(t):i.set(e,[t])},off:function(e,t){var n=i.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var n=i.get(e);n&&n.slice().map(function(s){s(t)}),(n=i.get("*"))&&n.slice().map(function(s){s(e,t)})}}}class Qr{constructor(){I(this,"emitter_instance");this.emitter_instance=Zr()}$on(e,t){this.emitter_instance.on(e,t)}$emit(e,...t){this.emitter_instance.emit(e,t)}$off(e,t){this.emitter_instance.off(e,t)}}function ks(i,e){if(e===qi)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===wn||e===ii){let t=i.getIndex();if(t===null){const r=[],c=i.getAttribute("position");if(c!==void 0){for(let a=0;a<c.count;a++)r.push(a);i.setIndex(r),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(e===wn)for(let r=1;r<=n;r++)s.push(t.getX(0)),s.push(t.getX(r)),s.push(t.getX(r+1));else for(let r=0;r<n;r++)r%2===0?(s.push(t.getX(r)),s.push(t.getX(r+1)),s.push(t.getX(r+2))):(s.push(t.getX(r+2)),s.push(t.getX(r+1)),s.push(t.getX(r)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=i.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}class Jr extends $i{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ia(t)}),this.register(function(t){return new da(t)}),this.register(function(t){return new ha(t)}),this.register(function(t){return new pa(t)}),this.register(function(t){return new ra(t)}),this.register(function(t){return new aa(t)}),this.register(function(t){return new ca(t)}),this.register(function(t){return new la(t)}),this.register(function(t){return new sa(t)}),this.register(function(t){return new ua(t)}),this.register(function(t){return new oa(t)}),this.register(function(t){return new fa(t)}),this.register(function(t){return new ta(t)}),this.register(function(t){return new ma(t)}),this.register(function(t){return new ya(t)})}load(e,t,n,s){const o=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=Tn.extractUrlBase(e),this.manager.itemStart(e);const c=function(l){s?s(l):console.error(l),o.manager.itemError(e),o.manager.itemEnd(e)},a=new oi(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{o.parse(l,r,function(f){t(f),o.manager.itemEnd(e)},c)}catch(f){c(f)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let o;const r={},c={},a=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===mi){try{r[k.KHR_BINARY_GLTF]=new ga(e)}catch(u){s&&s(u);return}o=JSON.parse(r[k.KHR_BINARY_GLTF].content)}else o=JSON.parse(a.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new La(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const u=this.pluginCallbacks[f](l);c[u.name]=u,r[u.name]=!0}if(o.extensionsUsed)for(let f=0;f<o.extensionsUsed.length;++f){const u=o.extensionsUsed[f],d=o.extensionsRequired||[];switch(u){case k.KHR_MATERIALS_UNLIT:r[u]=new na;break;case k.KHR_DRACO_MESH_COMPRESSION:r[u]=new xa(o,this.dracoLoader);break;case k.KHR_TEXTURE_TRANSFORM:r[u]=new Aa;break;case k.KHR_MESH_QUANTIZATION:r[u]=new ba;break;default:d.indexOf(u)>=0&&c[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(r),l.setPlugins(c),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,o){n.parse(e,t,s,o)})}}function ea(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const k={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ta{constructor(e){this.parser=e,this.name=k.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let l;const f=new le(16777215);a.color!==void 0&&f.fromArray(a.color);const u=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Ji(f),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Qi(f),l.distance=u;break;case"spot":l=new Zi(f),l.distance=u,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,Te(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,o=n.json.nodes[e],c=(o.extensions&&o.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(a){return n._getNodeRef(t.cache,c,a)})}}class na{constructor(){this.name=k.KHR_MATERIALS_UNLIT}getMaterialType(){return Ie}extendParams(e,t,n){const s=[];e.color=new le(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const r=o.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}o.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",o.baseColorTexture,Oe))}return Promise.all(s)}}class sa{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class ia{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const c=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new H(c,c)}return Promise.all(o)}}class oa{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(o)}}class ra{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new le(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];return r.sheenColorFactor!==void 0&&t.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Oe)),r.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(o)}}class aa{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(o)}}class ca{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const c=r.attenuationColor||[1,1,1];return t.attenuationColor=new le(c[0],c[1],c[2]),Promise.all(o)}}class la{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class ua{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",r.specularTexture));const c=r.specularColorFactor||[1,1,1];return t.specularColor=new le(c[0],c[1],c[2]),r.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",r.specularColorTexture,Oe)),Promise.all(o)}}class fa{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Me}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&o.push(n.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(o)}}class da{constructor(e){this.parser=e,this.name=k.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,r)}}class ha{constructor(e){this.parser=e,this.name=k.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],c=s.images[r.source];let a=n.textureLoader;if(c.uri){const l=n.options.manager.getHandler(c.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,r.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class pa{constructor(e){this.parser=e,this.name=k.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],c=s.images[r.source];let a=n.textureLoader;if(c.uri){const l=n.options.manager.getHandler(c.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,r.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ma{constructor(e){this.name=k.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(c){const a=s.byteOffset||0,l=s.byteLength||0,f=s.count,u=s.byteStride,d=new Uint8Array(c,a,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(f,u,d,s.mode,s.filter).then(function(h){return h.buffer}):r.ready.then(function(){const h=new ArrayBuffer(f*u);return r.decodeGltfBuffer(new Uint8Array(h),f,u,d,s.mode,s.filter),h})})}else return null}}class ya{constructor(e){this.name=k.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const l of s.primitives)if(l.mode!==ee.TRIANGLES&&l.mode!==ee.TRIANGLE_STRIP&&l.mode!==ee.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=n.extensions[this.name].attributes,c=[],a={};for(const l in r)c.push(this.parser.getDependency("accessor",r[l]).then(f=>(a[l]=f,a[l])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(l=>{const f=l.pop(),u=f.isGroup?f.children:[f],d=l[0].count,h=[];for(const m of u){const x=new G,p=new P,y=new yt,g=new P(1,1,1),b=new eo(m.geometry,m.material,d);for(let A=0;A<d;A++)a.TRANSLATION&&p.fromBufferAttribute(a.TRANSLATION,A),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,A),a.SCALE&&g.fromBufferAttribute(a.SCALE,A),b.setMatrixAt(A,x.compose(p,y,g));for(const A in a)A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&m.geometry.setAttribute(A,a[A]);Un.prototype.copy.call(b,m),this.parser.assignFinalMaterial(b),h.push(b)}return f.isGroup?(f.clear(),f.add(...h),f):h[0]}))}}const mi="glTF",ut=12,Bs={JSON:1313821514,BIN:5130562};class ga{constructor(e){this.name=k.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ut),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==mi)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-ut,o=new DataView(e,ut);let r=0;for(;r<s;){const c=o.getUint32(r,!0);r+=4;const a=o.getUint32(r,!0);if(r+=4,a===Bs.JSON){const l=new Uint8Array(e,ut+r,c);this.content=n.decode(l)}else if(a===Bs.BIN){const l=ut+r;this.body=e.slice(l,l+c)}r+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class xa{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=k.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,o=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,c={},a={},l={};for(const f in r){const u=In[f]||f.toLowerCase();c[u]=r[f]}for(const f in e.attributes){const u=In[f]||f.toLowerCase();if(r[f]!==void 0){const d=n.accessors[e.attributes[f]],h=$e[d.componentType];l[u]=h.name,a[u]=d.normalized===!0}}return t.getDependency("bufferView",o).then(function(f){return new Promise(function(u){s.decodeDracoFile(f,function(d){for(const h in d.attributes){const m=d.attributes[h],x=a[h];x!==void 0&&(m.normalized=x)}u(d)},c,l)})})}}class Aa{constructor(){this.name=k.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class ba{constructor(){this.name=k.KHR_MESH_QUANTIZATION}}class yi extends wo{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=e*s*3+s;for(let r=0;r!==s;r++)t[r]=n[o+r];return t}interpolate_(e,t,n,s){const o=this.resultBuffer,r=this.sampleValues,c=this.valueSize,a=c*2,l=c*3,f=s-t,u=(n-t)/f,d=u*u,h=d*u,m=e*l,x=m-l,p=-2*h+3*d,y=h-d,g=1-p,b=y-d+u;for(let A=0;A!==c;A++){const _=r[x+A+c],v=r[x+A+a]*f,T=r[m+A+c],E=r[m+A]*f;o[A]=g*_+b*v+p*T+y*E}return o}}const _a=new yt;class wa extends yi{interpolate_(e,t,n,s){const o=super.interpolate_(e,t,n,s);return _a.fromArray(o).normalize().toArray(o),o}}const ee={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},$e={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Fs={9728:po,9729:ai,9984:mo,9985:yo,9986:go,9987:ci},Us={33071:xo,33648:Ao,10497:vn},hn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},In={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_e={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ta={CUBICSPLINE:void 0,LINEAR:li,STEP:bo},pn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function va(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Hn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:bn})),i.DefaultMaterial}function Ce(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Te(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ea(i,e,t){let n=!1,s=!1,o=!1;for(let l=0,f=e.length;l<f;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(o=!0),n&&s&&o)break}if(!n&&!s&&!o)return Promise.resolve(i);const r=[],c=[],a=[];for(let l=0,f=e.length;l<f;l++){const u=e[l];if(n){const d=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):i.attributes.position;r.push(d)}if(s){const d=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):i.attributes.normal;c.push(d)}if(o){const d=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):i.attributes.color;a.push(d)}}return Promise.all([Promise.all(r),Promise.all(c),Promise.all(a)]).then(function(l){const f=l[0],u=l[1],d=l[2];return n&&(i.morphAttributes.position=f),s&&(i.morphAttributes.normal=u),o&&(i.morphAttributes.color=d),i.morphTargetsRelative=!0,i})}function Sa(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ma(i){let e;const t=i.extensions&&i.extensions[k.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+mn(t.attributes):e=i.indices+":"+mn(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,s=i.targets.length;n<s;n++)e+=":"+mn(i.targets[n]);return e}function mn(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}function On(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Pa(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ra=new G;class La{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ea,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,o=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,o=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&o<98?this.textureLoader=new ri(this.options.manager):this.textureLoader=new to(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new oi(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(r){const c={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:n,userData:{}};Ce(o,c,s),Te(c,s),Promise.all(n._invokeAll(function(a){return a.afterRoot&&a.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,o=t.length;s<o;s++){const r=t[s].joints;for(let c=0,a=r.length;c<a;c++)e[r[c]].isBone=!0}for(let s=0,o=e.length;s<o;s++){const r=e[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(n[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),o=(r,c)=>{const a=this.associations.get(r);a!=null&&this.associations.set(c,a);for(const[l,f]of r.children.entries())o(f,c.children[l])};return o(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const o=e(t[s]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(o,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[k.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,r){n.load(Tn.resolveURL(t.uri,s.path),o,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const r=hn[s.type],c=$e[s.componentType],a=s.normalized===!0,l=new c(s.count*r);return Promise.resolve(new Ee(l,r,a))}const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(r){const c=r[0],a=hn[s.type],l=$e[s.componentType],f=l.BYTES_PER_ELEMENT,u=f*a,d=s.byteOffset||0,h=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let x,p;if(h&&h!==u){const y=Math.floor(d/h),g="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let b=t.cache.get(g);b||(x=new l(c,y*h,s.count*h/f),b=new no(x,h/f),t.cache.add(g,b)),p=new _o(b,a,d%h/f,m)}else c===null?x=new l(s.count*a):x=new l(c,d,s.count*a),p=new Ee(x,a,m);if(s.sparse!==void 0){const y=hn.SCALAR,g=$e[s.sparse.indices.componentType],b=s.sparse.indices.byteOffset||0,A=s.sparse.values.byteOffset||0,_=new g(r[1],b,s.sparse.count*y),v=new l(r[2],A,s.sparse.count*a);c!==null&&(p=new Ee(p.array.slice(),p.itemSize,p.normalized));for(let T=0,E=_.length;T<E;T++){const M=_[T];if(p.setX(M,v[T*a]),a>=2&&p.setY(M,v[T*a+1]),a>=3&&p.setZ(M,v[T*a+2]),a>=4&&p.setW(M,v[T*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(e){const t=this.json,n=this.options,o=t.textures[e].source,r=t.images[o];let c=this.textureLoader;if(r.uri){const a=n.manager.getHandler(r.uri);a!==null&&(c=a)}return this.loadTextureImage(e,o,c)}loadTextureImage(e,t,n){const s=this,o=this.json,r=o.textures[e],c=o.images[t],a=(c.uri||c.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(f){f.flipY=!1,f.name=r.name||c.name||"",f.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(f.name=c.uri);const d=(o.samplers||{})[r.sampler]||{};return f.magFilter=Fs[d.magFilter]||ai,f.minFilter=Fs[d.minFilter]||ci,f.wrapS=Us[d.wrapS]||vn,f.wrapT=Us[d.wrapT]||vn,s.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,s=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=s.images[e],c=self.URL||self.webkitURL;let a=r.uri||"",l=!1;if(r.bufferView!==void 0)a=n.getDependency("bufferView",r.bufferView).then(function(u){l=!0;const d=new Blob([u],{type:r.mimeType});return a=c.createObjectURL(d),a});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(a).then(function(u){return new Promise(function(d,h){let m=d;t.isImageBitmapLoader===!0&&(m=function(x){const p=new cs(x);p.needsUpdate=!0,d(p)}),t.load(Tn.resolveURL(u,o.path),m,void 0,h)})}).then(function(u){return l===!0&&c.revokeObjectURL(a),u.userData.mimeType=r.mimeType||Pa(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),u});return this.sourceCache[e]=f,f}assignTexture(e,t,n,s){const o=this;return this.getDependency("texture",n.index).then(function(r){if(!r)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(r=r.clone(),r.channel=n.texCoord),o.extensions[k.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[k.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const a=o.associations.get(r);r=o.extensions[k.KHR_TEXTURE_TRANSFORM].extendTexture(r,c),o.associations.set(r,a)}}return s!==void 0&&(r.colorSpace=s),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let a=this.cache.get(c);a||(a=new so,Ft.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,a.sizeAttenuation=!1,this.cache.add(c,a)),n=a}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let a=this.cache.get(c);a||(a=new _n,Ft.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,this.cache.add(c,a)),n=a}if(s||o||r){let c="ClonedMaterial:"+n.uuid+":";s&&(c+="derivative-tangents:"),o&&(c+="vertex-colors:"),r&&(c+="flat-shading:");let a=this.cache.get(c);a||(a=n.clone(),o&&(a.vertexColors=!0),r&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(c,a),this.associations.set(a,this.associations.get(n))),n=a}e.material=n}getMaterialType(){return Hn}loadMaterial(e){const t=this,n=this.json,s=this.extensions,o=n.materials[e];let r;const c={},a=o.extensions||{},l=[];if(a[k.KHR_MATERIALS_UNLIT]){const u=s[k.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),l.push(u.extendParams(c,o,t))}else{const u=o.pbrMetallicRoughness||{};if(c.color=new le(1,1,1),c.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;c.color.fromArray(d),c.opacity=d[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(c,"map",u.baseColorTexture,Oe)),c.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,c.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(c,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(c,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,c)})))}o.doubleSided===!0&&(c.side=kn);const f=o.alphaMode||pn.OPAQUE;if(f===pn.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,f===pn.MASK&&(c.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&r!==Ie&&(l.push(t.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new H(1,1),o.normalTexture.scale!==void 0)){const u=o.normalTexture.scale;c.normalScale.set(u,u)}return o.occlusionTexture!==void 0&&r!==Ie&&(l.push(t.assignTexture(c,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&r!==Ie&&(c.emissive=new le().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&r!==Ie&&l.push(t.assignTexture(c,"emissiveMap",o.emissiveTexture,Oe)),Promise.all(l).then(function(){const u=new r(c);return o.name&&(u.name=o.name),Te(u,o),t.associations.set(u,{materials:e}),o.extensions&&Ce(s,u,o),u})}createUniqueName(e){const t=io.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function o(c){return n[k.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(a){return Hs(a,c,t)})}const r=[];for(let c=0,a=e.length;c<a;c++){const l=e[c],f=Ma(l),u=s[f];if(u)r.push(u.promise);else{let d;l.extensions&&l.extensions[k.KHR_DRACO_MESH_COMPRESSION]?d=o(l):d=Hs(new qe,l,t),s[f]={primitive:l,promise:d},r.push(d)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,s=this.extensions,o=n.meshes[e],r=o.primitives,c=[];for(let a=0,l=r.length;a<l;a++){const f=r[a].material===void 0?va(this.cache):this.getDependency("material",r[a].material);c.push(f)}return c.push(t.loadGeometries(r)),Promise.all(c).then(function(a){const l=a.slice(0,a.length-1),f=a[a.length-1],u=[];for(let h=0,m=f.length;h<m;h++){const x=f[h],p=r[h];let y;const g=l[h];if(p.mode===ee.TRIANGLES||p.mode===ee.TRIANGLE_STRIP||p.mode===ee.TRIANGLE_FAN||p.mode===void 0)y=o.isSkinnedMesh===!0?new oo(x,g):new Ze(x,g),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),p.mode===ee.TRIANGLE_STRIP?y.geometry=ks(y.geometry,ii):p.mode===ee.TRIANGLE_FAN&&(y.geometry=ks(y.geometry,wn));else if(p.mode===ee.LINES)y=new ro(x,g);else if(p.mode===ee.LINE_STRIP)y=new Js(x,g);else if(p.mode===ee.LINE_LOOP)y=new ao(x,g);else if(p.mode===ee.POINTS)y=new co(x,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(y.geometry.morphAttributes).length>0&&Sa(y,o),y.name=t.createUniqueName(o.name||"mesh_"+e),Te(y,o),p.extensions&&Ce(s,y,p),t.assignFinalMaterial(y),u.push(y)}for(let h=0,m=u.length;h<m;h++)t.associations.set(u[h],{meshes:e,primitives:h});if(u.length===1)return o.extensions&&Ce(s,u[0],o),u[0];const d=new Jt;o.extensions&&Ce(s,d,o),t.associations.set(d,{meshes:e});for(let h=0,m=u.length;h<m;h++)d.add(u[h]);return d})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Bn(jt.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new lo(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Te(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,o=t.joints.length;s<o;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const o=s.pop(),r=s,c=[],a=[];for(let l=0,f=r.length;l<f;l++){const u=r[l];if(u){c.push(u);const d=new G;o!==null&&d.fromArray(o.array,l*16),a.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new uo(c,a)})}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],o=s.name?s.name:"animation_"+e,r=[],c=[],a=[],l=[],f=[];for(let u=0,d=s.channels.length;u<d;u++){const h=s.channels[u],m=s.samplers[h.sampler],x=h.target,p=x.node,y=s.parameters!==void 0?s.parameters[m.input]:m.input,g=s.parameters!==void 0?s.parameters[m.output]:m.output;x.node!==void 0&&(r.push(this.getDependency("node",p)),c.push(this.getDependency("accessor",y)),a.push(this.getDependency("accessor",g)),l.push(m),f.push(x))}return Promise.all([Promise.all(r),Promise.all(c),Promise.all(a),Promise.all(l),Promise.all(f)]).then(function(u){const d=u[0],h=u[1],m=u[2],x=u[3],p=u[4],y=[];for(let g=0,b=d.length;g<b;g++){const A=d[g],_=h[g],v=m[g],T=x[g],E=p[g];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const M=n._createAnimationTracks(A,_,v,T,E);if(M)for(let R=0;R<M.length;R++)y.push(M[R])}return new fo(o,void 0,y)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(o){const r=n._getNodeRef(n.meshCache,s.mesh,o);return s.weights!==void 0&&r.traverse(function(c){if(c.isMesh)for(let a=0,l=s.weights.length;a<l;a++)c.morphTargetInfluences[a]=s.weights[a]}),r})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],o=n._loadNodeShallow(e),r=[],c=s.children||[];for(let l=0,f=c.length;l<f;l++)r.push(n.getDependency("node",c[l]));const a=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([o,Promise.all(r),a]).then(function(l){const f=l[0],u=l[1],d=l[2];d!==null&&f.traverse(function(h){h.isSkinnedMesh&&h.bind(d,Ra)});for(let h=0,m=u.length;h<m;h++)f.add(u[h]);return f})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],r=o.name?s.createUniqueName(o.name):"",c=[],a=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&c.push(a),o.camera!==void 0&&c.push(s.getDependency("camera",o.camera).then(function(l){return s._getNodeRef(s.cameraCache,o.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){c.push(l)}),this.nodeCache[e]=Promise.all(c).then(function(l){let f;if(o.isBone===!0?f=new ho:l.length>1?f=new Jt:l.length===1?f=l[0]:f=new Un,f!==l[0])for(let u=0,d=l.length;u<d;u++)f.add(l[u]);if(o.name&&(f.userData.name=o.name,f.name=r),Te(f,o),o.extensions&&Ce(n,f,o),o.matrix!==void 0){const u=new G;u.fromArray(o.matrix),f.applyMatrix4(u)}else o.translation!==void 0&&f.position.fromArray(o.translation),o.rotation!==void 0&&f.quaternion.fromArray(o.rotation),o.scale!==void 0&&f.scale.fromArray(o.scale);return s.associations.has(f)||s.associations.set(f,{}),s.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,o=new Jt;n.name&&(o.name=s.createUniqueName(n.name)),Te(o,n),n.extensions&&Ce(t,o,n);const r=n.nodes||[],c=[];for(let a=0,l=r.length;a<l;a++)c.push(s.getDependency("node",r[a]));return Promise.all(c).then(function(a){for(let f=0,u=a.length;f<u;f++)o.add(a[f]);const l=f=>{const u=new Map;for(const[d,h]of s.associations)(d instanceof Ft||d instanceof cs)&&u.set(d,h);return f.traverse(d=>{const h=s.associations.get(d);h!=null&&u.set(d,h)}),u};return s.associations=l(o),o})}_createAnimationTracks(e,t,n,s,o){const r=[],c=e.name?e.name:e.uuid,a=[];_e[o.path]===_e.weights?e.traverse(function(d){d.morphTargetInfluences&&a.push(d.name?d.name:d.uuid)}):a.push(c);let l;switch(_e[o.path]){case _e.weights:l=us;break;case _e.rotation:l=fs;break;case _e.position:case _e.scale:l=ls;break;default:switch(n.itemSize){case 1:l=us;break;case 2:case 3:default:l=ls;break}break}const f=s.interpolation!==void 0?Ta[s.interpolation]:li,u=this._getArrayFromAccessor(n);for(let d=0,h=a.length;d<h;d++){const m=new l(a[d]+"."+_e[o.path],t.array,u,f);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),r.push(m)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=On(t.constructor),s=new Float32Array(t.length);for(let o=0,r=t.length;o<r;o++)s[o]=t[o]*n;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const s=this instanceof fs?wa:yi;return new s(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ca(i,e,t){const n=e.attributes,s=new Q;if(n.POSITION!==void 0){const c=t.json.accessors[n.POSITION],a=c.min,l=c.max;if(a!==void 0&&l!==void 0){if(s.set(new P(a[0],a[1],a[2]),new P(l[0],l[1],l[2])),c.normalized){const f=On($e[c.componentType]);s.min.multiplyScalar(f),s.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const c=new P,a=new P;for(let l=0,f=o.length;l<f;l++){const u=o[l];if(u.POSITION!==void 0){const d=t.json.accessors[u.POSITION],h=d.min,m=d.max;if(h!==void 0&&m!==void 0){if(a.setX(Math.max(Math.abs(h[0]),Math.abs(m[0]))),a.setY(Math.max(Math.abs(h[1]),Math.abs(m[1]))),a.setZ(Math.max(Math.abs(h[2]),Math.abs(m[2]))),d.normalized){const x=On($e[d.componentType]);a.multiplyScalar(x)}c.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(c)}i.boundingBox=s;const r=new qs;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=r}function Hs(i,e,t){const n=e.attributes,s=[];function o(r,c){return t.getDependency("accessor",r).then(function(a){i.setAttribute(c,a)})}for(const r in n){const c=In[r]||r.toLowerCase();c in i.attributes||s.push(o(n[r],c))}if(e.indices!==void 0&&!i.index){const r=t.getDependency("accessor",e.indices).then(function(c){i.setIndex(c)});s.push(r)}return Te(i,e),Ca(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?Ea(i,e.targets,t):i})}class Ia{constructor(){I(this,"gltf_loader");I(this,"texture_loader");I(this,"audio_loader");I(this,"core");this.core=new ue,this.gltf_loader=new Jr,this.texture_loader=new ri,this.audio_loader=new To,vo.onProgress=(e,t,n)=>{this.core.$emit(zt,{url:e,loaded:t,total:n})}}}const Ht=(i,e)=>{const t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)},Oa=(i,e)=>{const t=e.x-i.x,n=e.y-i.y;return Da(Math.atan2(n,t))},Na=(i,e,t)=>{const n={x:0,y:0};return t=Nn(t),n.x=i.x-e*Math.cos(t),n.y=i.y-e*Math.sin(t),n},Nn=i=>i*(Math.PI/180),Da=i=>i*(180/Math.PI),ka=i=>isNaN(i.buttons)?i.pressure!==0:i.buttons!==0,yn=new Map,zs=i=>{yn.has(i)&&clearTimeout(yn.get(i)),yn.set(i,setTimeout(i,100))},Vt=(i,e,t)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],i.addEventListener?i.addEventListener(s,t,!1):i.attachEvent&&i.attachEvent(s,t)},js=(i,e,t)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],i.removeEventListener?i.removeEventListener(s,t):i.detachEvent&&i.detachEvent(s,t)},gi=i=>(i.preventDefault(),i.type.match(/^touch/)?i.changedTouches:i),Ks=()=>{const i=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:i,y:e}},Vs=(i,e)=>{e.top||e.right||e.bottom||e.left?(i.style.top=e.top,i.style.right=e.right,i.style.bottom=e.bottom,i.style.left=e.left):(i.style.left=e.x+"px",i.style.top=e.y+"px")},Vn=(i,e,t)=>{const n=xi(i);for(let s in n)if(n.hasOwnProperty(s))if(typeof e=="string")n[s]=e+" "+t;else{let o="";for(let r=0,c=e.length;r<c;r+=1)o+=e[r]+" "+t+", ";n[s]=o.slice(0,-2)}return n},Ba=(i,e)=>{const t=xi(i);for(let n in t)t.hasOwnProperty(n)&&(t[n]=e);return t},xi=i=>{const e={};return e[i]="",["webkit","Moz","o"].forEach(function(n){e[n+i.charAt(0).toUpperCase()+i.slice(1)]=""}),e},gn=(i,e)=>{for(let t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i},Fa=(i,e)=>{const t={};for(let n in i)i.hasOwnProperty(n)&&e.hasOwnProperty(n)?t[n]=e[n]:i.hasOwnProperty(n)&&(t[n]=i[n]);return t},Dn=(i,e)=>{if(i.length)for(let t=0,n=i.length;t<n;t+=1)e(i[t]);else e(i)},Ua=(i,e,t)=>({x:Math.min(Math.max(i.x,e.x-t),e.x+t),y:Math.min(Math.max(i.y,e.y-t),e.y+t)});var Ha="ontouchstart"in window,za=!!window.PointerEvent,ja=!!window.MSPointerEvent,ft={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Ye,gt={};za?Ye=ft.pointer:ja?Ye=ft.MSPointer:Ha?(Ye=ft.touch,gt=ft.mouse):Ye=ft.mouse;function ye(){}ye.prototype.on=function(i,e){var t=this,n=i.split(/[ ,]+/g),s;t._handlers_=t._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],t._handlers_[s]=t._handlers_[s]||[],t._handlers_[s].push(e);return t};ye.prototype.off=function(i,e){var t=this;return t._handlers_=t._handlers_||{},i===void 0?t._handlers_={}:e===void 0?t._handlers_[i]=null:t._handlers_[i]&&t._handlers_[i].indexOf(e)>=0&&t._handlers_[i].splice(t._handlers_[i].indexOf(e),1),t};ye.prototype.trigger=function(i,e){var t=this,n=i.split(/[ ,]+/g),s;t._handlers_=t._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],t._handlers_[s]&&t._handlers_[s].length&&t._handlers_[s].forEach(function(r){r.call(t,{type:s,target:t},e)})};ye.prototype.config=function(i){var e=this;e.options=e.defaults||{},i&&(e.options=Fa(e.options,i))};ye.prototype.bindEvt=function(i,e){var t=this;return t._domHandlers_=t._domHandlers_||{},t._domHandlers_[e]=function(){typeof t["on"+e]=="function"?t["on"+e].apply(t,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},Vt(i,Ye[e],t._domHandlers_[e]),gt[e]&&Vt(i,gt[e],t._domHandlers_[e]),t};ye.prototype.unbindEvt=function(i,e){var t=this;return t._domHandlers_=t._domHandlers_||{},js(i,Ye[e],t._domHandlers_[e]),gt[e]&&js(i,gt[e],t._domHandlers_[e]),delete t._domHandlers_[e],this};function X(i,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=i,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=X.id,X.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}X.prototype=new ye;X.constructor=X;X.id=0;X.prototype.buildEl=function(i){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};X.prototype.stylize=function(){if(this.options.dataOnly)return this;var i=this.options.fadeTime+"ms",e=Ba("borderRadius","50%"),t=Vn("transition","opacity",i),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},gn(n.el,t),this.options.shape==="circle"&&gn(n.back,e),gn(n.front,e),this.applyStyles(n),this};X.prototype.applyStyles=function(i){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var t in i[e])this.ui[e].style[t]=i[e][t];return this};X.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};X.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};X.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};X.prototype.show=function(i){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof i=="function"&&i.call(this)},e.options.fadeTime)),e};X.prototype.hide=function(i){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var t=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=t,typeof i=="function"&&i.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const t=e.options.restJoystick,n={};n.x=t===!0||t.x!==!1?0:e.instance.frontPosition.x,n.y=t===!0||t.y!==!1?0:e.instance.frontPosition.y,e.setPosition(i,n)}return e};X.prototype.setPosition=function(i,e){var t=this;t.frontPosition={x:e.x,y:e.y};var n=t.options.fadeTime+"ms",s={};s.front=Vn("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+t.frontPosition.x+"px,"+t.frontPosition.y+"px)"},t.applyStyles(s),t.applyStyles(o),t.restTimeout=setTimeout(function(){typeof i=="function"&&i.call(t),t.restCallback()},t.options.fadeTime)};X.prototype.restCallback=function(){var i=this,e={};e.front=Vn("transition","none",""),i.applyStyles(e),i.trigger("rested",i.instance)};X.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};X.prototype.computeDirection=function(i){var e=i.angle.radian,t=Math.PI/4,n=Math.PI/2,s,o,r;if(e>t&&e<t*3&&!i.lockX?s="up":e>-t&&e<=t&&!i.lockY?s="left":e>-t*3&&e<=-t&&!i.lockX?s="down":i.lockY||(s="right"),i.lockY||(e>-n&&e<n?o="left":o="right"),i.lockX||(e>0?r="up":r="down"),i.force>this.options.threshold){var c={},a;for(a in this.direction)this.direction.hasOwnProperty(a)&&(c[a]=this.direction[a]);var l={};this.direction={x:o,y:r,angle:s},i.direction=this.direction;for(a in c)c[a]===this.direction[a]&&(l[a]=!0);if(l.x&&l.y&&l.angle)return i;(!l.x||!l.y)&&this.trigger("plain",i),l.x||this.trigger("plain:"+o,i),l.y||this.trigger("plain:"+r,i),l.angle||this.trigger("dir dir:"+s,i)}else this.resetDirection();return i};function z(i,e){var t=this;t.nipples=[],t.idles=[],t.actives=[],t.ids=[],t.pressureIntervals={},t.manager=i,t.id=z.id,z.id+=1,t.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},t.config(e),(t.options.mode==="static"||t.options.mode==="semi")&&(t.options.multitouch=!1),t.options.multitouch||(t.options.maxNumberOfNipples=1);const n=getComputedStyle(t.options.zone.parentElement);return n&&n.display==="flex"&&(t.parentIsFlex=!0),t.updateBox(),t.prepareNipples(),t.bindings(),t.begin(),t.nipples}z.prototype=new ye;z.constructor=z;z.id=0;z.prototype.prepareNipples=function(){var i=this,e=i.nipples;e.on=i.on.bind(i),e.off=i.off.bind(i),e.options=i.options,e.destroy=i.destroy.bind(i),e.ids=i.ids,e.id=i.id,e.processOnMove=i.processOnMove.bind(i),e.processOnEnd=i.processOnEnd.bind(i),e.get=function(t){if(t===void 0)return e[0];for(var n=0,s=e.length;n<s;n+=1)if(e[n].identifier===t)return e[n];return!1}};z.prototype.bindings=function(){var i=this;i.bindEvt(i.options.zone,"start"),i.options.zone.style.touchAction="none",i.options.zone.style.msTouchAction="none"};z.prototype.begin=function(){var i=this,e=i.options;if(e.mode==="static"){var t=i.createNipple(e.position,i.manager.getIdentifier());t.add(),i.idles.push(t)}};z.prototype.createNipple=function(i,e){var t=this,n=t.manager.scroll,s={},o=t.options,r={x:t.parentIsFlex?n.x:n.x+t.box.left,y:t.parentIsFlex?n.y:n.y+t.box.top};if(i.x&&i.y)s={x:i.x-r.x,y:i.y-r.y};else if(i.top||i.right||i.bottom||i.left){var c=document.createElement("DIV");c.style.display="hidden",c.style.top=i.top,c.style.right=i.right,c.style.bottom=i.bottom,c.style.left=i.left,c.style.position="absolute",o.zone.appendChild(c);var a=c.getBoundingClientRect();o.zone.removeChild(c),s=i,i={x:a.left+n.x,y:a.top+n.y}}var l=new X(t,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:e,position:i,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(Vs(l.ui.el,s),Vs(l.ui.front,l.frontPosition)),t.nipples.push(l),t.trigger("added "+l.identifier+":added",l),t.manager.trigger("added "+l.identifier+":added",l),t.bindNipple(l),l};z.prototype.updateBox=function(){var i=this;i.box=i.options.zone.getBoundingClientRect()};z.prototype.bindNipple=function(i){var e=this,t,n=function(s,o){t=s.type+" "+o.id+":"+s.type,e.trigger(t,o)};i.on("destroyed",e.onDestroyed.bind(e)),i.on("shown hidden rested dir plain",n),i.on("dir:up dir:right dir:down dir:left",n),i.on("plain:up plain:right plain:down plain:left",n)};z.prototype.pressureFn=function(i,e,t){var n=this,s=0;clearInterval(n.pressureIntervals[t]),n.pressureIntervals[t]=setInterval((function(){var o=i.force||i.pressure||i.webkitForce||0;o!==s&&(e.trigger("pressure",o),n.trigger("pressure "+e.identifier+":pressure",o),s=o)}).bind(n),100)};z.prototype.onstart=function(i){var e=this,t=e.options,n=i;i=gi(i),e.updateBox();var s=function(o){e.actives.length<t.maxNumberOfNipples?e.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(r){if(Object.values(n.touches).findIndex(function(a){return a.identifier===r})<0){var c=[i[0]];c.identifier=r,e.processOnEnd(c)}}),e.actives.length<t.maxNumberOfNipples&&e.processOnStart(o))};return Dn(i,s),e.manager.bindDocument(),!1};z.prototype.processOnStart=function(i){var e=this,t=e.options,n,s=e.manager.getIdentifier(i),o=i.force||i.pressure||i.webkitForce||0,r={x:i.pageX,y:i.pageY},c=e.getOrCreate(s,r);c.identifier!==s&&e.manager.removeIdentifier(c.identifier),c.identifier=s;var a=function(f){f.trigger("start",f),e.trigger("start "+f.id+":start",f),f.show(),o>0&&e.pressureFn(i,f,f.identifier),e.processOnMove(i)};if((n=e.idles.indexOf(c))>=0&&e.idles.splice(n,1),e.actives.push(c),e.ids.push(c.identifier),t.mode!=="semi")a(c);else{var l=Ht(r,c.position);if(l<=t.catchDistance)a(c);else{c.destroy(),e.processOnStart(i);return}}return c};z.prototype.getOrCreate=function(i,e){var t=this,n=t.options,s;return/(semi|static)/.test(n.mode)?(s=t.idles[0],s?(t.idles.splice(0,1),s):n.mode==="semi"?t.createNipple(e,i):(console.warn("Coudln't find the needed nipple."),!1)):(s=t.createNipple(e,i),s)};z.prototype.processOnMove=function(i){var e=this,t=e.options,n=e.manager.getIdentifier(i),s=e.nipples.get(n),o=e.manager.scroll;if(!ka(i)){this.processOnEnd(i);return}if(!s){console.error("Found zombie joystick with ID "+n),e.manager.removeIdentifier(n);return}if(t.dynamicPage){var r=s.el.getBoundingClientRect();s.position={x:o.x+r.left,y:o.y+r.top}}s.identifier=n;var c=s.options.size/2,a={x:i.pageX,y:i.pageY};t.lockX&&(a.y=s.position.y),t.lockY&&(a.x=s.position.x);var l=Ht(a,s.position),f=Oa(a,s.position),u=Nn(f),d=l/c,h={distance:l,position:a},m,x;if(s.options.shape==="circle"?(m=Math.min(l,c),x=Na(s.position,m,f)):(x=Ua(a,s.position,c),m=Ht(x,s.position)),t.follow){if(l>c){let b=a.x-x.x,A=a.y-x.y;s.position.x+=b,s.position.y+=A,s.el.style.top=s.position.y-(e.box.top+o.y)+"px",s.el.style.left=s.position.x-(e.box.left+o.x)+"px",l=Ht(a,s.position)}}else a=x,l=m;var p=a.x-s.position.x,y=a.y-s.position.y;s.frontPosition={x:p,y},t.dataOnly||(s.ui.front.style.transform="translate("+p+"px,"+y+"px)");var g={identifier:s.identifier,position:a,force:d,pressure:i.force||i.pressure||i.webkitForce||0,distance:l,angle:{radian:u,degree:f},vector:{x:p/c,y:-y/c},raw:h,instance:s,lockX:t.lockX,lockY:t.lockY};g=s.computeDirection(g),g.angle={radian:Nn(180-f),degree:180-f},s.trigger("move",g),e.trigger("move "+s.id+":move",g)};z.prototype.processOnEnd=function(i){var e=this,t=e.options,n=e.manager.getIdentifier(i),s=e.nipples.get(n),o=e.manager.removeIdentifier(s.identifier);s&&(t.dataOnly||s.hide(function(){t.mode==="dynamic"&&(s.trigger("removed",s),e.trigger("removed "+s.id+":removed",s),e.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(e.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),e.trigger("end "+s.id+":end",s),e.ids.indexOf(s.identifier)>=0&&e.ids.splice(e.ids.indexOf(s.identifier),1),e.actives.indexOf(s)>=0&&e.actives.splice(e.actives.indexOf(s),1),/(semi|static)/.test(t.mode)?e.idles.push(s):e.nipples.indexOf(s)>=0&&e.nipples.splice(e.nipples.indexOf(s),1),e.manager.unbindDocument(),/(semi|static)/.test(t.mode)&&(e.manager.ids[o.id]=o.identifier))};z.prototype.onDestroyed=function(i,e){var t=this;t.nipples.indexOf(e)>=0&&t.nipples.splice(t.nipples.indexOf(e),1),t.actives.indexOf(e)>=0&&t.actives.splice(t.actives.indexOf(e),1),t.idles.indexOf(e)>=0&&t.idles.splice(t.idles.indexOf(e),1),t.ids.indexOf(e.identifier)>=0&&t.ids.splice(t.ids.indexOf(e.identifier),1),t.manager.removeIdentifier(e.identifier),t.manager.unbindDocument()};z.prototype.destroy=function(){var i=this;i.unbindEvt(i.options.zone,"start"),i.nipples.forEach(function(t){t.destroy()});for(var e in i.pressureIntervals)i.pressureIntervals.hasOwnProperty(e)&&clearInterval(i.pressureIntervals[e]);i.trigger("destroyed",i.nipples),i.manager.unbindDocument(),i.off()};function W(i){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=Ks(),e.config(i),e.prepareCollections();var t=function(){var s;e.collections.forEach(function(o){o.forEach(function(r){s=r.el.getBoundingClientRect(),r.position={x:e.scroll.x+s.left,y:e.scroll.y+s.top}})})};Vt(window,"resize",function(){zs(t)});var n=function(){e.scroll=Ks()};return Vt(window,"scroll",function(){zs(n)}),e.collections}W.prototype=new ye;W.constructor=W;W.prototype.prepareCollections=function(){var i=this;i.collections.create=i.create.bind(i),i.collections.on=i.on.bind(i),i.collections.off=i.off.bind(i),i.collections.destroy=i.destroy.bind(i),i.collections.get=function(e){var t;return i.collections.every(function(n){return t=n.get(e),!t}),t}};W.prototype.create=function(i){return this.createCollection(i)};W.prototype.createCollection=function(i){var e=this,t=new z(e,i);return e.bindCollection(t),e.collections.push(t),t};W.prototype.bindCollection=function(i){var e=this,t,n=function(s,o){t=s.type+" "+o.id+":"+s.type,e.trigger(t,o)};i.on("destroyed",e.onDestroyed.bind(e)),i.on("shown hidden rested dir plain",n),i.on("dir:up dir:right dir:down dir:left",n),i.on("plain:up plain:right plain:down plain:left",n)};W.prototype.bindDocument=function(){var i=this;i.binded||(i.bindEvt(document,"move").bindEvt(document,"end"),i.binded=!0)};W.prototype.unbindDocument=function(i){var e=this;(!Object.keys(e.ids).length||i===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};W.prototype.getIdentifier=function(i){var e;return i?(e=i.identifier===void 0?i.pointerId:i.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};W.prototype.removeIdentifier=function(i){var e={};for(var t in this.ids)if(this.ids[t]===i){e.id=t,e.identifier=this.ids[t],delete this.ids[t];break}return e};W.prototype.onmove=function(i){var e=this;return e.onAny("move",i),!1};W.prototype.onend=function(i){var e=this;return e.onAny("end",i),!1};W.prototype.oncancel=function(i){var e=this;return e.onAny("end",i),!1};W.prototype.onAny=function(i,e){var t=this,n,s="processOn"+i.charAt(0).toUpperCase()+i.slice(1);e=gi(e);var o=function(c,a,l){l.ids.indexOf(a)>=0&&(l[s](c),c._found_=!0)},r=function(c){n=t.getIdentifier(c),Dn(t.collections,o.bind(null,c,n)),c._found_||t.removeIdentifier(n)};return Dn(e,r),!1};W.prototype.destroy=function(){var i=this;i.unbindDocument(!0),i.ids={},i.index=0,i.collections.forEach(function(e){e.destroy()}),i.off()};W.prototype.onDestroyed=function(i,e){var t=this;if(t.collections.indexOf(e)<0)return!1;t.collections.splice(t.collections.indexOf(e),1)};const Gs=new W,Ka={create:function(i){return Gs.create(i)},factory:Gs};class Va{constructor(){I(this,"core");I(this,"key_status",{KeyW:!1,KeyS:!1,KeyA:!1,KeyD:!1,Space:!1});I(this,"is_enabled",!1);I(this,"key_sets",["KeyW","KeyS","KeyA","KeyD","Space"]);I(this,"joystick_element",document.getElementById("joystick"));I(this,"joystick_manager");I(this,"mode","pc");I(this,"move_degree");this.core=new ue,this._bindEvent()}_bindEvent(){var e,t;"ontouchstart"in window?(this.mode="mobile",this._createJoystick(),window.addEventListener("dblclick",()=>{document.documentElement.requestFullscreen()}),(e=this.joystick_manager)==null||e.on("move",(n,s)=>{this.move_degree=s.angle.degree}),(t=this.joystick_manager)==null||t.on("end",()=>{this.move_degree=void 0})):(document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)))}_createJoystick(){this.joystick_element.style.display="block",this.joystick_manager=Ka.create({zone:this.joystick_element,color:"black",mode:"static",position:{left:"50%",top:"50%"}})}_onKeyDown(e){this.isAllowKey(e.code)&&this.is_enabled&&(this.key_status[e.code]=!0,this.core.$emit(Zs,e.code))}_onKeyUp(e){this.isAllowKey(e.code)&&this.is_enabled&&(this.key_status[e.code]=!1,this.core.$emit(Eo,e.code))}isAllowKey(e){return this.key_sets.includes(e)}disabled(){this.is_enabled=!1}enabled(){this.is_enabled=!0}}const Xs={type:"change"},xn={type:"start"},Ws={type:"end"},Bt=new So,Ys=new Gt,Ga=Math.cos(70*jt.DEG2RAD);class Xa extends Mo{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new P,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:De.ROTATE,MIDDLE:De.DOLLY,RIGHT:De.PAN},this.touches={ONE:ke.ROTATE,TWO:ke.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(w){w.addEventListener("keydown",$t),this._domElementKeyEvents=w},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",$t),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Xs),n.update(),o=s.NONE},this.update=function(){const w=new P,N=new yt().setFromUnitVectors(e.up,new P(0,1,0)),j=N.clone().invert(),V=new P,q=new yt,Ne=new P,Ae=2*Math.PI;return function(){const ss=n.object.position;w.copy(ss).sub(n.target),w.applyQuaternion(N),c.setFromVector3(w),n.autoRotate&&o===s.NONE&&L(M()),n.enableDamping?(c.theta+=a.theta*n.dampingFactor,c.phi+=a.phi*n.dampingFactor):(c.theta+=a.theta,c.phi+=a.phi);let de=n.minAzimuthAngle,he=n.maxAzimuthAngle;isFinite(de)&&isFinite(he)&&(de<-Math.PI?de+=Ae:de>Math.PI&&(de-=Ae),he<-Math.PI?he+=Ae:he>Math.PI&&(he-=Ae),de<=he?c.theta=Math.max(de,Math.min(he,c.theta)):c.theta=c.theta>(de+he)/2?Math.max(de,c.theta):Math.min(he,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),n.zoomToCursor&&v||n.object.isOrthographicCamera?c.radius=fe(c.radius):c.radius=fe(c.radius*l),w.setFromSpherical(c),w.applyQuaternion(j),ss.copy(n.target).add(w),n.object.lookAt(n.target),n.enableDamping===!0?(a.theta*=1-n.dampingFactor,a.phi*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor)):(a.set(0,0,0),f.set(0,0,0));let xt=!1;if(n.zoomToCursor&&v){let et=null;if(n.object.isPerspectiveCamera){const tt=w.length();et=fe(tt*l);const At=tt-et;n.object.position.addScaledVector(A,At),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const tt=new P(_.x,_.y,0);tt.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),xt=!0;const At=new P(_.x,_.y,0);At.unproject(n.object),n.object.position.sub(At).add(tt),n.object.updateMatrixWorld(),et=w.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;et!==null&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(et).add(n.object.position):(Bt.origin.copy(n.object.position),Bt.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Bt.direction))<Ga?e.lookAt(n.target):(Ys.setFromNormalAndCoplanarPoint(n.object.up,n.target),Bt.intersectPlane(Ys,n.target))))}else n.object.isOrthographicCamera&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),xt=!0);return l=1,v=!1,xt||V.distanceToSquared(n.object.position)>r||8*(1-q.dot(n.object.quaternion))>r||Ne.distanceToSquared(n.target)>0?(n.dispatchEvent(Xs),V.copy(n.object.position),q.copy(n.object.quaternion),Ne.copy(n.target),xt=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",ts),n.domElement.removeEventListener("pointerdown",Jn),n.domElement.removeEventListener("pointercancel",Je),n.domElement.removeEventListener("wheel",es),n.domElement.removeEventListener("pointermove",qt),n.domElement.removeEventListener("pointerup",Je),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",$t),n._domElementKeyEvents=null)};const n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const r=1e-6,c=new ds,a=new ds;let l=1;const f=new P,u=new H,d=new H,h=new H,m=new H,x=new H,p=new H,y=new H,g=new H,b=new H,A=new P,_=new H;let v=!1;const T=[],E={};function M(){return 2*Math.PI/60/60*n.autoRotateSpeed}function R(){return Math.pow(.95,n.zoomSpeed)}function L(w){a.theta-=w}function S(w){a.phi-=w}const C=function(){const w=new P;return function(j,V){w.setFromMatrixColumn(V,0),w.multiplyScalar(-j),f.add(w)}}(),O=function(){const w=new P;return function(j,V){n.screenSpacePanning===!0?w.setFromMatrixColumn(V,1):(w.setFromMatrixColumn(V,0),w.crossVectors(n.object.up,w)),w.multiplyScalar(j),f.add(w)}}(),D=function(){const w=new P;return function(j,V){const q=n.domElement;if(n.object.isPerspectiveCamera){const Ne=n.object.position;w.copy(Ne).sub(n.target);let Ae=w.length();Ae*=Math.tan(n.object.fov/2*Math.PI/180),C(2*j*Ae/q.clientHeight,n.object.matrix),O(2*V*Ae/q.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(C(j*(n.object.right-n.object.left)/n.object.zoom/q.clientWidth,n.object.matrix),O(V*(n.object.top-n.object.bottom)/n.object.zoom/q.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function B(w){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=w:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ge(w){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=w:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function xe(w){if(!n.zoomToCursor)return;v=!0;const N=n.domElement.getBoundingClientRect(),j=w.clientX-N.left,V=w.clientY-N.top,q=N.width,Ne=N.height;_.x=j/q*2-1,_.y=-(V/Ne)*2+1,A.set(_.x,_.y,1).unproject(e).sub(e.position).normalize()}function fe(w){return Math.max(n.minDistance,Math.min(n.maxDistance,w))}function Gn(w){u.set(w.clientX,w.clientY)}function Ai(w){xe(w),y.set(w.clientX,w.clientY)}function Xn(w){m.set(w.clientX,w.clientY)}function bi(w){d.set(w.clientX,w.clientY),h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const N=n.domElement;L(2*Math.PI*h.x/N.clientHeight),S(2*Math.PI*h.y/N.clientHeight),u.copy(d),n.update()}function _i(w){g.set(w.clientX,w.clientY),b.subVectors(g,y),b.y>0?B(R()):b.y<0&&ge(R()),y.copy(g),n.update()}function wi(w){x.set(w.clientX,w.clientY),p.subVectors(x,m).multiplyScalar(n.panSpeed),D(p.x,p.y),m.copy(x),n.update()}function Ti(w){xe(w),w.deltaY<0?ge(R()):w.deltaY>0&&B(R()),n.update()}function vi(w){let N=!1;switch(w.code){case n.keys.UP:w.ctrlKey||w.metaKey||w.shiftKey?S(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):D(0,n.keyPanSpeed),N=!0;break;case n.keys.BOTTOM:w.ctrlKey||w.metaKey||w.shiftKey?S(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):D(0,-n.keyPanSpeed),N=!0;break;case n.keys.LEFT:w.ctrlKey||w.metaKey||w.shiftKey?L(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):D(n.keyPanSpeed,0),N=!0;break;case n.keys.RIGHT:w.ctrlKey||w.metaKey||w.shiftKey?L(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):D(-n.keyPanSpeed,0),N=!0;break}N&&(w.preventDefault(),n.update())}function Wn(){if(T.length===1)u.set(T[0].pageX,T[0].pageY);else{const w=.5*(T[0].pageX+T[1].pageX),N=.5*(T[0].pageY+T[1].pageY);u.set(w,N)}}function Yn(){if(T.length===1)m.set(T[0].pageX,T[0].pageY);else{const w=.5*(T[0].pageX+T[1].pageX),N=.5*(T[0].pageY+T[1].pageY);m.set(w,N)}}function qn(){const w=T[0].pageX-T[1].pageX,N=T[0].pageY-T[1].pageY,j=Math.sqrt(w*w+N*N);y.set(0,j)}function Ei(){n.enableZoom&&qn(),n.enablePan&&Yn()}function Si(){n.enableZoom&&qn(),n.enableRotate&&Wn()}function $n(w){if(T.length==1)d.set(w.pageX,w.pageY);else{const j=Zt(w),V=.5*(w.pageX+j.x),q=.5*(w.pageY+j.y);d.set(V,q)}h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const N=n.domElement;L(2*Math.PI*h.x/N.clientHeight),S(2*Math.PI*h.y/N.clientHeight),u.copy(d)}function Zn(w){if(T.length===1)x.set(w.pageX,w.pageY);else{const N=Zt(w),j=.5*(w.pageX+N.x),V=.5*(w.pageY+N.y);x.set(j,V)}p.subVectors(x,m).multiplyScalar(n.panSpeed),D(p.x,p.y),m.copy(x)}function Qn(w){const N=Zt(w),j=w.pageX-N.x,V=w.pageY-N.y,q=Math.sqrt(j*j+V*V);g.set(0,q),b.set(0,Math.pow(g.y/y.y,n.zoomSpeed)),B(b.y),y.copy(g)}function Mi(w){n.enableZoom&&Qn(w),n.enablePan&&Zn(w)}function Pi(w){n.enableZoom&&Qn(w),n.enableRotate&&$n(w)}function Jn(w){n.enabled!==!1&&(T.length===0&&(n.domElement.setPointerCapture(w.pointerId),n.domElement.addEventListener("pointermove",qt),n.domElement.addEventListener("pointerup",Je)),Oi(w),w.pointerType==="touch"?Ci(w):Ri(w))}function qt(w){n.enabled!==!1&&(w.pointerType==="touch"?Ii(w):Li(w))}function Je(w){Ni(w),T.length===0&&(n.domElement.releasePointerCapture(w.pointerId),n.domElement.removeEventListener("pointermove",qt),n.domElement.removeEventListener("pointerup",Je)),n.dispatchEvent(Ws),o=s.NONE}function Ri(w){let N;switch(w.button){case 0:N=n.mouseButtons.LEFT;break;case 1:N=n.mouseButtons.MIDDLE;break;case 2:N=n.mouseButtons.RIGHT;break;default:N=-1}switch(N){case De.DOLLY:if(n.enableZoom===!1)return;Ai(w),o=s.DOLLY;break;case De.ROTATE:if(w.ctrlKey||w.metaKey||w.shiftKey){if(n.enablePan===!1)return;Xn(w),o=s.PAN}else{if(n.enableRotate===!1)return;Gn(w),o=s.ROTATE}break;case De.PAN:if(w.ctrlKey||w.metaKey||w.shiftKey){if(n.enableRotate===!1)return;Gn(w),o=s.ROTATE}else{if(n.enablePan===!1)return;Xn(w),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(xn)}function Li(w){switch(o){case s.ROTATE:if(n.enableRotate===!1)return;bi(w);break;case s.DOLLY:if(n.enableZoom===!1)return;_i(w);break;case s.PAN:if(n.enablePan===!1)return;wi(w);break}}function es(w){n.enabled===!1||n.enableZoom===!1||o!==s.NONE||(w.preventDefault(),n.dispatchEvent(xn),Ti(w),n.dispatchEvent(Ws))}function $t(w){n.enabled===!1||n.enablePan===!1||vi(w)}function Ci(w){switch(ns(w),T.length){case 1:switch(n.touches.ONE){case ke.ROTATE:if(n.enableRotate===!1)return;Wn(),o=s.TOUCH_ROTATE;break;case ke.PAN:if(n.enablePan===!1)return;Yn(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(n.touches.TWO){case ke.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Ei(),o=s.TOUCH_DOLLY_PAN;break;case ke.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Si(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(xn)}function Ii(w){switch(ns(w),o){case s.TOUCH_ROTATE:if(n.enableRotate===!1)return;$n(w),n.update();break;case s.TOUCH_PAN:if(n.enablePan===!1)return;Zn(w),n.update();break;case s.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Mi(w),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Pi(w),n.update();break;default:o=s.NONE}}function ts(w){n.enabled!==!1&&w.preventDefault()}function Oi(w){T.push(w)}function Ni(w){delete E[w.pointerId];for(let N=0;N<T.length;N++)if(T[N].pointerId==w.pointerId){T.splice(N,1);return}}function ns(w){let N=E[w.pointerId];N===void 0&&(N=new H,E[w.pointerId]=N),N.set(w.pageX,w.pageY)}function Zt(w){const N=w.pointerId===T[0].pointerId?T[1]:T[0];return E[N.pointerId]}n.domElement.addEventListener("contextmenu",ts),n.domElement.addEventListener("pointerdown",Jn),n.domElement.addEventListener("pointercancel",Je),n.domElement.addEventListener("wheel",es,{passive:!1}),this.update()}}class Wa{constructor(){I(this,"core");I(this,"doms");this.core=new ue,this.doms={loading:document.querySelector(".loading"),loading_complete:document.querySelector(".loading-complete"),preview_tooltip:document.querySelector(".preview-tooltip"),preview_tips:document.querySelector(".preview-tips"),boards_dialog:document.querySelector(".boards-info"),boards_container:document.querySelector(".boards-info .boards-container"),boards_content:document.querySelector(".boards-info .boards-container .content"),boards_title:document.querySelector(".boards-container .info .title"),boards_author:document.querySelector(".boards-container .info .author"),boards_describe:document.querySelector(".boards-container .info .describe"),boards_img:document.querySelector(".boards-container .img img"),help_btn:document.querySelector(".help"),operating_intro:document.querySelector(".operating-intro")},document.body.addEventListener("click",this.handleClick.bind(this))}handleClick(e){if(e.target instanceof HTMLElement){const n=[{verify:()=>e.target.classList.contains("start"),handler:this.onClickEnterApp.bind(this)},{verify:()=>this._isBInA(["boards-info-close","boards-info"],e.target.classList.value.split(" ")),handler:this.hideBoardsBox.bind(this)},{verify:()=>e.target.classList.contains("help"),handler:this.showHelp.bind(this)},{verify:()=>this._isBInA(["operating-intro-close","operating-intro","operating-intro-img"],e.target.classList.value.split(" ")),handler:this.hideHelp.bind(this)}].find(s=>s.verify());n&&n.handler()}}onClickEnterApp(){this.doms.loading_complete.classList.remove("display-none"),this.doms.loading_complete.remove(),this.core.$emit(si)}showHelp(){this.doms.operating_intro.classList.remove("display-none")}hideHelp(){this.doms.operating_intro.classList.add("display-none")}showBoardsBox(e,t,n,s){this.doms.boards_dialog.style.visibility!=="visible"&&(this.doms.boards_dialog.style.visibility="visible",this.doms.boards_container.classList.remove("hide"),this.doms.boards_title.innerText=e,this.doms.boards_author.innerText=t,this.doms.boards_describe.innerHTML=n,this.doms.boards_img.src=s,this.doms.boards_content.scrollTo({top:0,left:0,behavior:"smooth"}))}hideBoardsBox(){this.doms.boards_dialog.style.visibility="hidden",this.doms.boards_container.classList.add("hide"),this.doms.boards_title.textContent="",this.doms.boards_author.textContent="",this.doms.boards_describe.textContent="",this.doms.boards_img.src=""}showPreviewTooltip(e,t=!0){this.doms.preview_tooltip.classList.remove("hide"),t&&this.doms.preview_tips.classList.remove("hide"),this.doms.preview_tooltip.innerText!==e&&(this.doms.preview_tooltip.innerText=e)}hidePreviewTooltip(){this.doms.preview_tooltip.classList.add("hide"),this.doms.preview_tips.classList.add("hide")}updateLoadingProgress(e){const t=this.doms.loading.querySelector(".progress");t&&(t.textContent=e)}removeLoading(){this.doms.loading.remove()}showLoadingConfirm(){this.doms.loading_complete.classList.remove("display-none")}_isBInA(e,t){return t.some(n=>e.includes(n))}}let An=null;class ue extends Qr{constructor(){super();I(this,"scene");I(this,"renderer");I(this,"camera");I(this,"clock");I(this,"orbit_controls");I(this,"ui");I(this,"control_manage");I(this,"loader");I(this,"world");if(An)return An;An=this,this.scene=new Qs,this.renderer=new Po({antialias:!0}),this.camera=new Bn,this.clock=new Ro,this.orbit_controls=new Xa(this.camera,this.renderer.domElement),this._initScene(),this._initCamera(),this._initRenderer(),this._initResponsiveResize(),this.ui=new Wa,this.control_manage=new Va,this.loader=new Ia,this.world=new $r}render(){this.renderer.setAnimationLoop(()=>{this.renderer.render(this.scene,this.camera);const t=Math.min(.05,this.clock.getDelta());this.world.update(t),this.orbit_controls.update()})}_initScene(){this.scene.background=new le(0)}_initCamera(){this.camera.fov=55,this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.near=.1,this.camera.far=1e3,this.camera.position.set(0,0,3),this.camera.updateProjectionMatrix()}_initRenderer(){var t;this.renderer.shadowMap.enabled=!0,this.renderer.outputColorSpace=Oe,this.renderer.toneMapping=Lo,this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.zIndex="1",this.renderer.domElement.style.top="0px",(t=document.querySelector("#app"))==null||t.appendChild(this.renderer.domElement)}_initResponsiveResize(){window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio)})}}const Ya=new ue;Ya.render();
